"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["_app-pages-browser_node_modules_twa-dev_sdk_dist_index_js"],{

/***/ "(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/index.js":
/*!*************************************************!*\
  !*** ./node_modules/@twa-dev/sdk/dist/index.js ***!
  \*************************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval(__webpack_require__.ts("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nvar sdk_1 = __webpack_require__(/*! ./sdk */ \"(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/sdk.js\");\nexports[\"default\"] = sdk_1.WebApp;\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AdHdhLWRldi9zZGsvZGlzdC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiLDhDQUE2QyxFQUFFLGFBQWEsRUFBQztBQUM3RCxZQUFZLG1CQUFPLENBQUMsMEVBQU87QUFDM0Isa0JBQWU7QUFDZiIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9ub2RlX21vZHVsZXMvQHR3YS1kZXYvc2RrL2Rpc3QvaW5kZXguanM/OTc3MiJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBzZGtfMSA9IHJlcXVpcmUoXCIuL3Nka1wiKTtcbmV4cG9ydHMuZGVmYXVsdCA9IHNka18xLldlYkFwcDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/index.js\n"));

/***/ }),

/***/ "(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/sdk.js":
/*!***********************************************!*\
  !*** ./node_modules/@twa-dev/sdk/dist/sdk.js ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {

eval(__webpack_require__.ts("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nexports.WebApp = void 0;\n__webpack_require__(/*! ./telegram-web-apps */ \"(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/telegram-web-apps.js\");\nvar telegramWindow = window;\nexports.WebApp = telegramWindow.Telegram.WebApp;\n//# sourceMappingURL=sdk.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AdHdhLWRldi9zZGsvZGlzdC9zZGsuanMiLCJtYXBwaW5ncyI6IkFBQWE7QUFDYiw4Q0FBNkMsRUFBRSxhQUFhLEVBQUM7QUFDN0QsY0FBYztBQUNkLG1CQUFPLENBQUMsc0dBQXFCO0FBQzdCO0FBQ0EsY0FBYztBQUNkIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL25vZGVfbW9kdWxlcy9AdHdhLWRldi9zZGsvZGlzdC9zZGsuanM/MWQ5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuV2ViQXBwID0gdm9pZCAwO1xucmVxdWlyZShcIi4vdGVsZWdyYW0td2ViLWFwcHNcIik7XG52YXIgdGVsZWdyYW1XaW5kb3cgPSB3aW5kb3c7XG5leHBvcnRzLldlYkFwcCA9IHRlbGVncmFtV2luZG93LlRlbGVncmFtLldlYkFwcDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNkay5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/sdk.js\n"));

/***/ }),

/***/ "(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/telegram-web-apps.js":
/*!*************************************************************!*\
  !*** ./node_modules/@twa-dev/sdk/dist/telegram-web-apps.js ***!
  \*************************************************************/
/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {

eval(__webpack_require__.ts("\n// WebView\n(function () {\n    var eventHandlers = {};\n    var locationHash = '';\n    try {\n        locationHash = location.hash.toString();\n    }\n    catch (e) { }\n    var initParams = urlParseHashParams(locationHash);\n    var storedParams = sessionStorageGet('initParams');\n    if (storedParams) {\n        for (var key in storedParams) {\n            if (typeof initParams[key] === 'undefined') {\n                initParams[key] = storedParams[key];\n            }\n        }\n    }\n    sessionStorageSet('initParams', initParams);\n    var isIframe = false, iFrameStyle;\n    try {\n        isIframe = (window.parent != null && window != window.parent);\n        if (isIframe) {\n            window.addEventListener('message', function (event) {\n                if (event.source !== window.parent)\n                    return;\n                try {\n                    var dataParsed = JSON.parse(event.data);\n                }\n                catch (e) {\n                    return;\n                }\n                if (!dataParsed || !dataParsed.eventType) {\n                    return;\n                }\n                if (dataParsed.eventType == 'set_custom_style') {\n                    if (event.origin === 'https://web.telegram.org') {\n                        iFrameStyle.innerHTML = dataParsed.eventData;\n                    }\n                }\n                else if (dataParsed.eventType == 'reload_iframe') {\n                    try {\n                        window.parent.postMessage(JSON.stringify({ eventType: 'iframe_will_reload' }), '*');\n                    }\n                    catch (e) { }\n                    location.reload();\n                }\n                else {\n                    receiveEvent(dataParsed.eventType, dataParsed.eventData);\n                }\n            });\n            iFrameStyle = document.createElement('style');\n            document.head.appendChild(iFrameStyle);\n            try {\n                window.parent.postMessage(JSON.stringify({ eventType: 'iframe_ready', eventData: { reload_supported: true } }), '*');\n            }\n            catch (e) { }\n        }\n    }\n    catch (e) { }\n    function urlSafeDecode(urlencoded) {\n        try {\n            urlencoded = urlencoded.replace(/\\+/g, '%20');\n            return decodeURIComponent(urlencoded);\n        }\n        catch (e) {\n            return urlencoded;\n        }\n    }\n    function urlParseHashParams(locationHash) {\n        locationHash = locationHash.replace(/^#/, '');\n        var params = {};\n        if (!locationHash.length) {\n            return params;\n        }\n        if (locationHash.indexOf('=') < 0 && locationHash.indexOf('?') < 0) {\n            params._path = urlSafeDecode(locationHash);\n            return params;\n        }\n        var qIndex = locationHash.indexOf('?');\n        if (qIndex >= 0) {\n            var pathParam = locationHash.substr(0, qIndex);\n            params._path = urlSafeDecode(pathParam);\n            locationHash = locationHash.substr(qIndex + 1);\n        }\n        var query_params = urlParseQueryString(locationHash);\n        for (var k in query_params) {\n            params[k] = query_params[k];\n        }\n        return params;\n    }\n    function urlParseQueryString(queryString) {\n        var params = {};\n        if (!queryString.length) {\n            return params;\n        }\n        var queryStringParams = queryString.split('&');\n        var i, param, paramName, paramValue;\n        for (i = 0; i < queryStringParams.length; i++) {\n            param = queryStringParams[i].split('=');\n            paramName = urlSafeDecode(param[0]);\n            paramValue = param[1] == null ? null : urlSafeDecode(param[1]);\n            params[paramName] = paramValue;\n        }\n        return params;\n    }\n    // Telegram apps will implement this logic to add service params (e.g. tgShareScoreUrl) to game URL\n    function urlAppendHashParams(url, addHash) {\n        // url looks like 'https://game.com/path?query=1#hash'\n        // addHash looks like 'tgShareScoreUrl=' + encodeURIComponent('tgb://share_game_score?hash=very_long_hash123')\n        var ind = url.indexOf('#');\n        if (ind < 0) {\n            // https://game.com/path -> https://game.com/path#tgShareScoreUrl=etc\n            return url + '#' + addHash;\n        }\n        var curHash = url.substr(ind + 1);\n        if (curHash.indexOf('=') >= 0 || curHash.indexOf('?') >= 0) {\n            // https://game.com/#hash=1 -> https://game.com/#hash=1&tgShareScoreUrl=etc\n            // https://game.com/#path?query -> https://game.com/#path?query&tgShareScoreUrl=etc\n            return url + '&' + addHash;\n        }\n        // https://game.com/#hash -> https://game.com/#hash?tgShareScoreUrl=etc\n        if (curHash.length > 0) {\n            return url + '?' + addHash;\n        }\n        // https://game.com/# -> https://game.com/#tgShareScoreUrl=etc\n        return url + addHash;\n    }\n    function postEvent(eventType, callback, eventData) {\n        if (!callback) {\n            callback = function () { };\n        }\n        if (eventData === undefined) {\n            eventData = '';\n        }\n        console.log('[Telegram.WebView] > postEvent', eventType, eventData);\n        if (window.TelegramWebviewProxy !== undefined) {\n            TelegramWebviewProxy.postEvent(eventType, JSON.stringify(eventData));\n            callback();\n        }\n        else if (window.external && 'notify' in window.external) {\n            window.external.notify(JSON.stringify({ eventType: eventType, eventData: eventData }));\n            callback();\n        }\n        else if (isIframe) {\n            try {\n                var trustedTarget = 'https://web.telegram.org';\n                // For now we don't restrict target, for testing purposes\n                trustedTarget = '*';\n                window.parent.postMessage(JSON.stringify({ eventType: eventType, eventData: eventData }), trustedTarget);\n                callback();\n            }\n            catch (e) {\n                callback(e);\n            }\n        }\n        else {\n            callback({ notAvailable: true });\n        }\n    }\n    ;\n    function receiveEvent(eventType, eventData) {\n        console.log('[Telegram.WebView] < receiveEvent', eventType, eventData);\n        callEventCallbacks(eventType, function (callback) {\n            callback(eventType, eventData);\n        });\n    }\n    function callEventCallbacks(eventType, func) {\n        var curEventHandlers = eventHandlers[eventType];\n        if (curEventHandlers === undefined ||\n            !curEventHandlers.length) {\n            return;\n        }\n        for (var i = 0; i < curEventHandlers.length; i++) {\n            try {\n                func(curEventHandlers[i]);\n            }\n            catch (e) { }\n        }\n    }\n    function onEvent(eventType, callback) {\n        if (eventHandlers[eventType] === undefined) {\n            eventHandlers[eventType] = [];\n        }\n        var index = eventHandlers[eventType].indexOf(callback);\n        if (index === -1) {\n            eventHandlers[eventType].push(callback);\n        }\n    }\n    ;\n    function offEvent(eventType, callback) {\n        if (eventHandlers[eventType] === undefined) {\n            return;\n        }\n        var index = eventHandlers[eventType].indexOf(callback);\n        if (index === -1) {\n            return;\n        }\n        eventHandlers[eventType].splice(index, 1);\n    }\n    ;\n    function openProtoUrl(url) {\n        if (!url.match(/^(web\\+)?tgb?:\\/\\/./)) {\n            return false;\n        }\n        var useIframe = navigator.userAgent.match(/iOS|iPhone OS|iPhone|iPod|iPad/i) ? true : false;\n        if (useIframe) {\n            var iframeContEl = document.getElementById('tgme_frame_cont') || document.body;\n            var iframeEl = document.createElement('iframe');\n            iframeContEl.appendChild(iframeEl);\n            var pageHidden = false;\n            var enableHidden = function () {\n                pageHidden = true;\n            };\n            window.addEventListener('pagehide', enableHidden, false);\n            window.addEventListener('blur', enableHidden, false);\n            if (iframeEl !== null) {\n                iframeEl.src = url;\n            }\n            setTimeout(function () {\n                if (!pageHidden) {\n                    window.location = url;\n                }\n                window.removeEventListener('pagehide', enableHidden, false);\n                window.removeEventListener('blur', enableHidden, false);\n            }, 2000);\n        }\n        else {\n            window.location = url;\n        }\n        return true;\n    }\n    function sessionStorageSet(key, value) {\n        try {\n            window.sessionStorage.setItem('__telegram__' + key, JSON.stringify(value));\n            return true;\n        }\n        catch (e) { }\n        return false;\n    }\n    function sessionStorageGet(key) {\n        try {\n            return JSON.parse(window.sessionStorage.getItem('__telegram__' + key));\n        }\n        catch (e) { }\n        return null;\n    }\n    if (!window.Telegram) {\n        window.Telegram = {};\n    }\n    window.Telegram.WebView = {\n        initParams: initParams,\n        isIframe: isIframe,\n        onEvent: onEvent,\n        offEvent: offEvent,\n        postEvent: postEvent,\n        receiveEvent: receiveEvent,\n        callEventCallbacks: callEventCallbacks\n    };\n    window.Telegram.Utils = {\n        urlSafeDecode: urlSafeDecode,\n        urlParseQueryString: urlParseQueryString,\n        urlParseHashParams: urlParseHashParams,\n        urlAppendHashParams: urlAppendHashParams,\n        sessionStorageSet: sessionStorageSet,\n        sessionStorageGet: sessionStorageGet\n    };\n    // For Windows Phone app\n    window.TelegramGameProxy_receiveEvent = receiveEvent;\n    // App backward compatibility\n    window.TelegramGameProxy = {\n        receiveEvent: receiveEvent\n    };\n})();\n// WebApp\n(function () {\n    var Utils = window.Telegram.Utils;\n    var WebView = window.Telegram.WebView;\n    var initParams = WebView.initParams;\n    var isIframe = WebView.isIframe;\n    var WebApp = {};\n    var webAppInitData = '', webAppInitDataUnsafe = {};\n    var themeParams = {}, colorScheme = 'light';\n    var webAppVersion = '6.0';\n    var webAppPlatform = 'unknown';\n    if (initParams.tgWebAppData && initParams.tgWebAppData.length) {\n        webAppInitData = initParams.tgWebAppData;\n        webAppInitDataUnsafe = Utils.urlParseQueryString(webAppInitData);\n        for (var key in webAppInitDataUnsafe) {\n            var val = webAppInitDataUnsafe[key];\n            try {\n                if (val.substr(0, 1) == '{' && val.substr(-1) == '}' ||\n                    val.substr(0, 1) == '[' && val.substr(-1) == ']') {\n                    webAppInitDataUnsafe[key] = JSON.parse(val);\n                }\n            }\n            catch (e) { }\n        }\n    }\n    if (initParams.tgWebAppThemeParams && initParams.tgWebAppThemeParams.length) {\n        var themeParamsRaw = initParams.tgWebAppThemeParams;\n        try {\n            var theme_params = JSON.parse(themeParamsRaw);\n            if (theme_params) {\n                setThemeParams(theme_params);\n            }\n        }\n        catch (e) { }\n    }\n    var theme_params = Utils.sessionStorageGet('themeParams');\n    if (theme_params) {\n        setThemeParams(theme_params);\n    }\n    if (initParams.tgWebAppVersion) {\n        webAppVersion = initParams.tgWebAppVersion;\n    }\n    if (initParams.tgWebAppPlatform) {\n        webAppPlatform = initParams.tgWebAppPlatform;\n    }\n    function onThemeChanged(eventType, eventData) {\n        if (eventData.theme_params) {\n            setThemeParams(eventData.theme_params);\n            window.Telegram.WebApp.MainButton.setParams({});\n            updateBackgroundColor();\n            receiveWebViewEvent('themeChanged');\n        }\n    }\n    var lastWindowHeight = window.innerHeight;\n    function onViewportChanged(eventType, eventData) {\n        if (eventData.height) {\n            window.removeEventListener('resize', onWindowResize);\n            setViewportHeight(eventData);\n        }\n    }\n    function onWindowResize(e) {\n        if (lastWindowHeight != window.innerHeight) {\n            lastWindowHeight = window.innerHeight;\n            receiveWebViewEvent('viewportChanged', {\n                isStateStable: true\n            });\n        }\n    }\n    function linkHandler(e) {\n        if (e.metaKey || e.ctrlKey)\n            return;\n        var el = e.target;\n        while (el.tagName != 'A' && el.parentNode) {\n            el = el.parentNode;\n        }\n        if (el.tagName == 'A' &&\n            el.target != '_blank' &&\n            (el.protocol == 'http:' || el.protocol == 'https:') &&\n            el.hostname == 't.me') {\n            WebApp.openTgLink(el.href);\n            e.preventDefault();\n        }\n    }\n    function strTrim(str) {\n        return str.toString().replace(/^\\s+|\\s+$/g, '');\n    }\n    function receiveWebViewEvent(eventType) {\n        var args = Array.prototype.slice.call(arguments);\n        eventType = args.shift();\n        WebView.callEventCallbacks('webview:' + eventType, function (callback) {\n            callback.apply(WebApp, args);\n        });\n    }\n    function onWebViewEvent(eventType, callback) {\n        WebView.onEvent('webview:' + eventType, callback);\n    }\n    ;\n    function offWebViewEvent(eventType, callback) {\n        WebView.offEvent('webview:' + eventType, callback);\n    }\n    ;\n    function setCssProperty(name, value) {\n        var root = document.documentElement;\n        if (root && root.style && root.style.setProperty) {\n            root.style.setProperty('--tg-' + name, value);\n        }\n    }\n    function setThemeParams(theme_params) {\n        // temp iOS fix\n        if (theme_params.bg_color == '#1c1c1d' &&\n            theme_params.bg_color == theme_params.secondary_bg_color) {\n            theme_params.secondary_bg_color = '#2c2c2e';\n        }\n        var color;\n        for (var key in theme_params) {\n            if (color = parseColorToHex(theme_params[key])) {\n                themeParams[key] = color;\n                if (key == 'bg_color') {\n                    colorScheme = isColorDark(color) ? 'dark' : 'light';\n                    setCssProperty('color-scheme', colorScheme);\n                }\n                key = 'theme-' + key.split('_').join('-');\n                setCssProperty(key, color);\n            }\n        }\n        Utils.sessionStorageSet('themeParams', themeParams);\n    }\n    var webAppCallbacks = {};\n    function generateCallbackId(len) {\n        var tries = 100;\n        while (--tries) {\n            var id = '', chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', chars_len = chars.length;\n            for (var i = 0; i < len; i++) {\n                id += chars[Math.floor(Math.random() * chars_len)];\n            }\n            if (!webAppCallbacks[id]) {\n                webAppCallbacks[id] = {};\n                return id;\n            }\n        }\n        throw Error('WebAppCallbackIdGenerateFailed');\n    }\n    var viewportHeight = false, viewportStableHeight = false, isExpanded = true;\n    function setViewportHeight(data) {\n        if (typeof data !== 'undefined') {\n            isExpanded = !!data.is_expanded;\n            viewportHeight = data.height;\n            if (data.is_state_stable) {\n                viewportStableHeight = data.height;\n            }\n            receiveWebViewEvent('viewportChanged', {\n                isStateStable: !!data.is_state_stable\n            });\n        }\n        var height, stable_height;\n        if (viewportHeight !== false) {\n            height = (viewportHeight - mainButtonHeight) + 'px';\n        }\n        else {\n            height = mainButtonHeight ? 'calc(100vh - ' + mainButtonHeight + 'px)' : '100vh';\n        }\n        if (viewportStableHeight !== false) {\n            stable_height = (viewportStableHeight - mainButtonHeight) + 'px';\n        }\n        else {\n            stable_height = mainButtonHeight ? 'calc(100vh - ' + mainButtonHeight + 'px)' : '100vh';\n        }\n        setCssProperty('viewport-height', height);\n        setCssProperty('viewport-stable-height', stable_height);\n    }\n    var isClosingConfirmationEnabled = false;\n    function setClosingConfirmation(need_confirmation) {\n        if (!versionAtLeast('6.2')) {\n            console.warn('[Telegram.WebApp] Closing confirmation is not supported in version ' + webAppVersion);\n            return;\n        }\n        isClosingConfirmationEnabled = !!need_confirmation;\n        WebView.postEvent('web_app_setup_closing_behavior', false, { need_confirmation: isClosingConfirmationEnabled });\n    }\n    var headerColorKey = 'bg_color', headerColor = null;\n    function getHeaderColor() {\n        if (headerColorKey == 'secondary_bg_color') {\n            return themeParams.secondary_bg_color;\n        }\n        else if (headerColorKey == 'bg_color') {\n            return themeParams.bg_color;\n        }\n        return headerColor;\n    }\n    function setHeaderColor(color) {\n        if (!versionAtLeast('6.1')) {\n            console.warn('[Telegram.WebApp] Header color is not supported in version ' + webAppVersion);\n            return;\n        }\n        if (!versionAtLeast('6.9')) {\n            if (themeParams.bg_color &&\n                themeParams.bg_color == color) {\n                color = 'bg_color';\n            }\n            else if (themeParams.secondary_bg_color &&\n                themeParams.secondary_bg_color == color) {\n                color = 'secondary_bg_color';\n            }\n        }\n        var head_color = null, color_key = null;\n        if (color == 'bg_color' || color == 'secondary_bg_color') {\n            color_key = color;\n        }\n        else if (versionAtLeast('6.9')) {\n            head_color = parseColorToHex(color);\n            if (!head_color) {\n                console.error('[Telegram.WebApp] Header color format is invalid', color);\n                throw Error('WebAppHeaderColorInvalid');\n            }\n        }\n        if (!versionAtLeast('6.9') &&\n            color_key != 'bg_color' &&\n            color_key != 'secondary_bg_color') {\n            console.error('[Telegram.WebApp] Header color key should be one of Telegram.WebApp.themeParams.bg_color, Telegram.WebApp.themeParams.secondary_bg_color, \\'bg_color\\', \\'secondary_bg_color\\'', color);\n            throw Error('WebAppHeaderColorKeyInvalid');\n        }\n        headerColorKey = color_key;\n        headerColor = head_color;\n        updateHeaderColor();\n    }\n    var appHeaderColorKey = null, appHeaderColor = null;\n    function updateHeaderColor() {\n        if (appHeaderColorKey != headerColorKey ||\n            appHeaderColor != headerColor) {\n            appHeaderColorKey = headerColorKey;\n            appHeaderColor = headerColor;\n            if (appHeaderColor) {\n                WebView.postEvent('web_app_set_header_color', false, { color: headerColor });\n            }\n            else {\n                WebView.postEvent('web_app_set_header_color', false, { color_key: headerColorKey });\n            }\n        }\n    }\n    var backgroundColor = 'bg_color';\n    function getBackgroundColor() {\n        if (backgroundColor == 'secondary_bg_color') {\n            return themeParams.secondary_bg_color;\n        }\n        else if (backgroundColor == 'bg_color') {\n            return themeParams.bg_color;\n        }\n        return backgroundColor;\n    }\n    function setBackgroundColor(color) {\n        if (!versionAtLeast('6.1')) {\n            console.warn('[Telegram.WebApp] Background color is not supported in version ' + webAppVersion);\n            return;\n        }\n        var bg_color;\n        if (color == 'bg_color' || color == 'secondary_bg_color') {\n            bg_color = color;\n        }\n        else {\n            bg_color = parseColorToHex(color);\n            if (!bg_color) {\n                console.error('[Telegram.WebApp] Background color format is invalid', color);\n                throw Error('WebAppBackgroundColorInvalid');\n            }\n        }\n        backgroundColor = bg_color;\n        updateBackgroundColor();\n    }\n    var appBackgroundColor = null;\n    function updateBackgroundColor() {\n        var color = getBackgroundColor();\n        if (appBackgroundColor != color) {\n            appBackgroundColor = color;\n            WebView.postEvent('web_app_set_background_color', false, { color: color });\n        }\n    }\n    function parseColorToHex(color) {\n        color += '';\n        var match;\n        if (match = /^\\s*#([0-9a-f]{6})\\s*$/i.exec(color)) {\n            return '#' + match[1].toLowerCase();\n        }\n        else if (match = /^\\s*#([0-9a-f])([0-9a-f])([0-9a-f])\\s*$/i.exec(color)) {\n            return ('#' + match[1] + match[1] + match[2] + match[2] + match[3] + match[3]).toLowerCase();\n        }\n        else if (match = /^\\s*rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+\\.{0,1}\\d*))?\\)\\s*$/.exec(color)) {\n            var r = parseInt(match[1]), g = parseInt(match[2]), b = parseInt(match[3]);\n            r = (r < 16 ? '0' : '') + r.toString(16);\n            g = (g < 16 ? '0' : '') + g.toString(16);\n            b = (b < 16 ? '0' : '') + b.toString(16);\n            return '#' + r + g + b;\n        }\n        return false;\n    }\n    function isColorDark(rgb) {\n        rgb = rgb.replace(/[\\s#]/g, '');\n        if (rgb.length == 3) {\n            rgb = rgb[0] + rgb[0] + rgb[1] + rgb[1] + rgb[2] + rgb[2];\n        }\n        var r = parseInt(rgb.substr(0, 2), 16);\n        var g = parseInt(rgb.substr(2, 2), 16);\n        var b = parseInt(rgb.substr(4, 2), 16);\n        var hsp = Math.sqrt(0.299 * (r * r) + 0.587 * (g * g) + 0.114 * (b * b));\n        return hsp < 120;\n    }\n    function versionCompare(v1, v2) {\n        if (typeof v1 !== 'string')\n            v1 = '';\n        if (typeof v2 !== 'string')\n            v2 = '';\n        v1 = v1.replace(/^\\s+|\\s+$/g, '').split('.');\n        v2 = v2.replace(/^\\s+|\\s+$/g, '').split('.');\n        var a = Math.max(v1.length, v2.length), i, p1, p2;\n        for (i = 0; i < a; i++) {\n            p1 = parseInt(v1[i]) || 0;\n            p2 = parseInt(v2[i]) || 0;\n            if (p1 == p2)\n                continue;\n            if (p1 > p2)\n                return 1;\n            return -1;\n        }\n        return 0;\n    }\n    function versionAtLeast(ver) {\n        return versionCompare(webAppVersion, ver) >= 0;\n    }\n    function byteLength(str) {\n        if (window.Blob) {\n            try {\n                return new Blob([str]).size;\n            }\n            catch (e) { }\n        }\n        var s = str.length;\n        for (var i = str.length - 1; i >= 0; i--) {\n            var code = str.charCodeAt(i);\n            if (code > 0x7f && code <= 0x7ff)\n                s++;\n            else if (code > 0x7ff && code <= 0xffff)\n                s += 2;\n            if (code >= 0xdc00 && code <= 0xdfff)\n                i--;\n        }\n        return s;\n    }\n    var BackButton = (function () {\n        var isVisible = false;\n        var backButton = {};\n        Object.defineProperty(backButton, 'isVisible', {\n            set: function (val) { setParams({ is_visible: val }); },\n            get: function () { return isVisible; },\n            enumerable: true\n        });\n        var curButtonState = null;\n        WebView.onEvent('back_button_pressed', onBackButtonPressed);\n        function onBackButtonPressed() {\n            receiveWebViewEvent('backButtonClicked');\n        }\n        function buttonParams() {\n            return { is_visible: isVisible };\n        }\n        function buttonState(btn_params) {\n            if (typeof btn_params === 'undefined') {\n                btn_params = buttonParams();\n            }\n            return JSON.stringify(btn_params);\n        }\n        function buttonCheckVersion() {\n            if (!versionAtLeast('6.1')) {\n                console.warn('[Telegram.WebApp] BackButton is not supported in version ' + webAppVersion);\n                return false;\n            }\n            return true;\n        }\n        function updateButton() {\n            var btn_params = buttonParams();\n            var btn_state = buttonState(btn_params);\n            if (curButtonState === btn_state) {\n                return;\n            }\n            curButtonState = btn_state;\n            WebView.postEvent('web_app_setup_back_button', false, btn_params);\n        }\n        function setParams(params) {\n            if (!buttonCheckVersion()) {\n                return backButton;\n            }\n            if (typeof params.is_visible !== 'undefined') {\n                isVisible = !!params.is_visible;\n            }\n            updateButton();\n            return backButton;\n        }\n        backButton.onClick = function (callback) {\n            if (buttonCheckVersion()) {\n                onWebViewEvent('backButtonClicked', callback);\n            }\n            return backButton;\n        };\n        backButton.offClick = function (callback) {\n            if (buttonCheckVersion()) {\n                offWebViewEvent('backButtonClicked', callback);\n            }\n            return backButton;\n        };\n        backButton.show = function () {\n            return setParams({ is_visible: true });\n        };\n        backButton.hide = function () {\n            return setParams({ is_visible: false });\n        };\n        return backButton;\n    })();\n    var mainButtonHeight = 0;\n    var MainButton = (function () {\n        var isVisible = false;\n        var isActive = true;\n        var isProgressVisible = false;\n        var buttonText = 'CONTINUE';\n        var buttonColor = false;\n        var buttonTextColor = false;\n        var mainButton = {};\n        Object.defineProperty(mainButton, 'text', {\n            set: function (val) { mainButton.setParams({ text: val }); },\n            get: function () { return buttonText; },\n            enumerable: true\n        });\n        Object.defineProperty(mainButton, 'color', {\n            set: function (val) { mainButton.setParams({ color: val }); },\n            get: function () { return buttonColor || themeParams.button_color || '#2481cc'; },\n            enumerable: true\n        });\n        Object.defineProperty(mainButton, 'textColor', {\n            set: function (val) { mainButton.setParams({ text_color: val }); },\n            get: function () { return buttonTextColor || themeParams.button_text_color || '#ffffff'; },\n            enumerable: true\n        });\n        Object.defineProperty(mainButton, 'isVisible', {\n            set: function (val) { mainButton.setParams({ is_visible: val }); },\n            get: function () { return isVisible; },\n            enumerable: true\n        });\n        Object.defineProperty(mainButton, 'isProgressVisible', {\n            get: function () { return isProgressVisible; },\n            enumerable: true\n        });\n        Object.defineProperty(mainButton, 'isActive', {\n            set: function (val) { mainButton.setParams({ is_active: val }); },\n            get: function () { return isActive; },\n            enumerable: true\n        });\n        var curButtonState = null;\n        WebView.onEvent('main_button_pressed', onMainButtonPressed);\n        var debugBtn = null, debugBtnStyle = {};\n        if (initParams.tgWebAppDebug) {\n            debugBtn = document.createElement('tg-main-button');\n            debugBtnStyle = {\n                font: '600 14px/18px sans-serif',\n                display: 'none',\n                width: '100%',\n                height: '48px',\n                borderRadius: '0',\n                background: 'no-repeat right center',\n                position: 'fixed',\n                left: '0',\n                right: '0',\n                bottom: '0',\n                margin: '0',\n                padding: '15px 20px',\n                textAlign: 'center',\n                boxSizing: 'border-box',\n                zIndex: '10000'\n            };\n            for (var k in debugBtnStyle) {\n                debugBtn.style[k] = debugBtnStyle[k];\n            }\n            document.addEventListener('DOMContentLoaded', function onDomLoaded(event) {\n                document.removeEventListener('DOMContentLoaded', onDomLoaded);\n                document.body.appendChild(debugBtn);\n                debugBtn.addEventListener('click', onMainButtonPressed, false);\n            });\n        }\n        function onMainButtonPressed() {\n            if (isActive) {\n                receiveWebViewEvent('mainButtonClicked');\n            }\n        }\n        function buttonParams() {\n            var color = mainButton.color;\n            var text_color = mainButton.textColor;\n            return isVisible ? {\n                is_visible: true,\n                is_active: isActive,\n                is_progress_visible: isProgressVisible,\n                text: buttonText,\n                color: color,\n                text_color: text_color\n            } : { is_visible: false };\n        }\n        function buttonState(btn_params) {\n            if (typeof btn_params === 'undefined') {\n                btn_params = buttonParams();\n            }\n            return JSON.stringify(btn_params);\n        }\n        function updateButton() {\n            var btn_params = buttonParams();\n            var btn_state = buttonState(btn_params);\n            if (curButtonState === btn_state) {\n                return;\n            }\n            curButtonState = btn_state;\n            WebView.postEvent('web_app_setup_main_button', false, btn_params);\n            if (initParams.tgWebAppDebug) {\n                updateDebugButton(btn_params);\n            }\n        }\n        function updateDebugButton(btn_params) {\n            if (btn_params.is_visible) {\n                debugBtn.style.display = 'block';\n                mainButtonHeight = 48;\n                debugBtn.style.opacity = btn_params.is_active ? '1' : '0.8';\n                debugBtn.style.cursor = btn_params.is_active ? 'pointer' : 'auto';\n                debugBtn.disabled = !btn_params.is_active;\n                debugBtn.innerText = btn_params.text;\n                debugBtn.style.backgroundImage = btn_params.is_progress_visible ? \"url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20viewport%3D%220%200%2048%2048%22%20width%3D%2248px%22%20height%3D%2248px%22%3E%3Ccircle%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20stroke%3D%22%23fff%22%20stroke-width%3D%222.25%22%20stroke-linecap%3D%22round%22%20fill%3D%22none%22%20stroke-dashoffset%3D%22106%22%20r%3D%229%22%20stroke-dasharray%3D%2256.52%22%20rotate%3D%22-90%22%3E%3Canimate%20attributeName%3D%22stroke-dashoffset%22%20attributeType%3D%22XML%22%20dur%3D%22360s%22%20from%3D%220%22%20to%3D%2212500%22%20repeatCount%3D%22indefinite%22%3E%3C%2Fanimate%3E%3CanimateTransform%20attributeName%3D%22transform%22%20attributeType%3D%22XML%22%20type%3D%22rotate%22%20dur%3D%221s%22%20from%3D%22-90%2024%2024%22%20to%3D%22630%2024%2024%22%20repeatCount%3D%22indefinite%22%3E%3C%2FanimateTransform%3E%3C%2Fcircle%3E%3C%2Fsvg%3E')\" : 'none';\n                debugBtn.style.backgroundColor = btn_params.color;\n                debugBtn.style.color = btn_params.text_color;\n            }\n            else {\n                debugBtn.style.display = 'none';\n                mainButtonHeight = 0;\n            }\n            if (document.documentElement) {\n                document.documentElement.style.boxSizing = 'border-box';\n                document.documentElement.style.paddingBottom = mainButtonHeight + 'px';\n            }\n            setViewportHeight();\n        }\n        function setParams(params) {\n            if (typeof params.text !== 'undefined') {\n                var text = strTrim(params.text);\n                if (!text.length) {\n                    console.error('[Telegram.WebApp] Main button text is required', params.text);\n                    throw Error('WebAppMainButtonParamInvalid');\n                }\n                if (text.length > 64) {\n                    console.error('[Telegram.WebApp] Main button text is too long', text);\n                    throw Error('WebAppMainButtonParamInvalid');\n                }\n                buttonText = text;\n            }\n            if (typeof params.color !== 'undefined') {\n                if (params.color === false ||\n                    params.color === null) {\n                    buttonColor = false;\n                }\n                else {\n                    var color = parseColorToHex(params.color);\n                    if (!color) {\n                        console.error('[Telegram.WebApp] Main button color format is invalid', params.color);\n                        throw Error('WebAppMainButtonParamInvalid');\n                    }\n                    buttonColor = color;\n                }\n            }\n            if (typeof params.text_color !== 'undefined') {\n                if (params.text_color === false ||\n                    params.text_color === null) {\n                    buttonTextColor = false;\n                }\n                else {\n                    var text_color = parseColorToHex(params.text_color);\n                    if (!text_color) {\n                        console.error('[Telegram.WebApp] Main button text color format is invalid', params.text_color);\n                        throw Error('WebAppMainButtonParamInvalid');\n                    }\n                    buttonTextColor = text_color;\n                }\n            }\n            if (typeof params.is_visible !== 'undefined') {\n                if (params.is_visible &&\n                    !mainButton.text.length) {\n                    console.error('[Telegram.WebApp] Main button text is required');\n                    throw Error('WebAppMainButtonParamInvalid');\n                }\n                isVisible = !!params.is_visible;\n            }\n            if (typeof params.is_active !== 'undefined') {\n                isActive = !!params.is_active;\n            }\n            updateButton();\n            return mainButton;\n        }\n        mainButton.setText = function (text) {\n            return mainButton.setParams({ text: text });\n        };\n        mainButton.onClick = function (callback) {\n            onWebViewEvent('mainButtonClicked', callback);\n            return mainButton;\n        };\n        mainButton.offClick = function (callback) {\n            offWebViewEvent('mainButtonClicked', callback);\n            return mainButton;\n        };\n        mainButton.show = function () {\n            return mainButton.setParams({ is_visible: true });\n        };\n        mainButton.hide = function () {\n            return mainButton.setParams({ is_visible: false });\n        };\n        mainButton.enable = function () {\n            return mainButton.setParams({ is_active: true });\n        };\n        mainButton.disable = function () {\n            return mainButton.setParams({ is_active: false });\n        };\n        mainButton.showProgress = function (leaveActive) {\n            isActive = !!leaveActive;\n            isProgressVisible = true;\n            updateButton();\n            return mainButton;\n        };\n        mainButton.hideProgress = function () {\n            if (!mainButton.isActive) {\n                isActive = true;\n            }\n            isProgressVisible = false;\n            updateButton();\n            return mainButton;\n        };\n        mainButton.setParams = setParams;\n        return mainButton;\n    })();\n    var SettingsButton = (function () {\n        var isVisible = false;\n        var settingsButton = {};\n        Object.defineProperty(settingsButton, 'isVisible', {\n            set: function (val) { setParams({ is_visible: val }); },\n            get: function () { return isVisible; },\n            enumerable: true\n        });\n        var curButtonState = null;\n        WebView.onEvent('settings_button_pressed', onSettingsButtonPressed);\n        function onSettingsButtonPressed() {\n            receiveWebViewEvent('settingsButtonClicked');\n        }\n        function buttonParams() {\n            return { is_visible: isVisible };\n        }\n        function buttonState(btn_params) {\n            if (typeof btn_params === 'undefined') {\n                btn_params = buttonParams();\n            }\n            return JSON.stringify(btn_params);\n        }\n        function buttonCheckVersion() {\n            if (!versionAtLeast('6.10')) {\n                console.warn('[Telegram.WebApp] SettingsButton is not supported in version ' + webAppVersion);\n                return false;\n            }\n            return true;\n        }\n        function updateButton() {\n            var btn_params = buttonParams();\n            var btn_state = buttonState(btn_params);\n            if (curButtonState === btn_state) {\n                return;\n            }\n            curButtonState = btn_state;\n            WebView.postEvent('web_app_setup_settings_button', false, btn_params);\n        }\n        function setParams(params) {\n            if (!buttonCheckVersion()) {\n                return settingsButton;\n            }\n            if (typeof params.is_visible !== 'undefined') {\n                isVisible = !!params.is_visible;\n            }\n            updateButton();\n            return settingsButton;\n        }\n        settingsButton.onClick = function (callback) {\n            if (buttonCheckVersion()) {\n                onWebViewEvent('settingsButtonClicked', callback);\n            }\n            return settingsButton;\n        };\n        settingsButton.offClick = function (callback) {\n            if (buttonCheckVersion()) {\n                offWebViewEvent('settingsButtonClicked', callback);\n            }\n            return settingsButton;\n        };\n        settingsButton.show = function () {\n            return setParams({ is_visible: true });\n        };\n        settingsButton.hide = function () {\n            return setParams({ is_visible: false });\n        };\n        return settingsButton;\n    })();\n    var HapticFeedback = (function () {\n        var hapticFeedback = {};\n        function triggerFeedback(params) {\n            if (!versionAtLeast('6.1')) {\n                console.warn('[Telegram.WebApp] HapticFeedback is not supported in version ' + webAppVersion);\n                return hapticFeedback;\n            }\n            if (params.type == 'impact') {\n                if (params.impact_style != 'light' &&\n                    params.impact_style != 'medium' &&\n                    params.impact_style != 'heavy' &&\n                    params.impact_style != 'rigid' &&\n                    params.impact_style != 'soft') {\n                    console.error('[Telegram.WebApp] Haptic impact style is invalid', params.impact_style);\n                    throw Error('WebAppHapticImpactStyleInvalid');\n                }\n            }\n            else if (params.type == 'notification') {\n                if (params.notification_type != 'error' &&\n                    params.notification_type != 'success' &&\n                    params.notification_type != 'warning') {\n                    console.error('[Telegram.WebApp] Haptic notification type is invalid', params.notification_type);\n                    throw Error('WebAppHapticNotificationTypeInvalid');\n                }\n            }\n            else if (params.type == 'selection_change') {\n                // no params needed\n            }\n            else {\n                console.error('[Telegram.WebApp] Haptic feedback type is invalid', params.type);\n                throw Error('WebAppHapticFeedbackTypeInvalid');\n            }\n            WebView.postEvent('web_app_trigger_haptic_feedback', false, params);\n            return hapticFeedback;\n        }\n        hapticFeedback.impactOccurred = function (style) {\n            return triggerFeedback({ type: 'impact', impact_style: style });\n        };\n        hapticFeedback.notificationOccurred = function (type) {\n            return triggerFeedback({ type: 'notification', notification_type: type });\n        };\n        hapticFeedback.selectionChanged = function () {\n            return triggerFeedback({ type: 'selection_change' });\n        };\n        return hapticFeedback;\n    })();\n    var CloudStorage = (function () {\n        var cloudStorage = {};\n        function invokeStorageMethod(method, params, callback) {\n            if (!versionAtLeast('6.9')) {\n                console.error('[Telegram.WebApp] CloudStorage is not supported in version ' + webAppVersion);\n                throw Error('WebAppMethodUnsupported');\n            }\n            invokeCustomMethod(method, params, callback);\n            return cloudStorage;\n        }\n        cloudStorage.setItem = function (key, value, callback) {\n            return invokeStorageMethod('saveStorageValue', { key: key, value: value }, callback);\n        };\n        cloudStorage.getItem = function (key, callback) {\n            return cloudStorage.getItems([key], callback ? function (err, res) {\n                if (err)\n                    callback(err);\n                else\n                    callback(null, res[key]);\n            } : null);\n        };\n        cloudStorage.getItems = function (keys, callback) {\n            return invokeStorageMethod('getStorageValues', { keys: keys }, callback);\n        };\n        cloudStorage.removeItem = function (key, callback) {\n            return cloudStorage.removeItems([key], callback);\n        };\n        cloudStorage.removeItems = function (keys, callback) {\n            return invokeStorageMethod('deleteStorageValues', { keys: keys }, callback);\n        };\n        cloudStorage.getKeys = function (callback) {\n            return invokeStorageMethod('getStorageKeys', {}, callback);\n        };\n        return cloudStorage;\n    })();\n    var webAppInvoices = {};\n    function onInvoiceClosed(eventType, eventData) {\n        if (eventData.slug && webAppInvoices[eventData.slug]) {\n            var invoiceData = webAppInvoices[eventData.slug];\n            delete webAppInvoices[eventData.slug];\n            if (invoiceData.callback) {\n                invoiceData.callback(eventData.status);\n            }\n            receiveWebViewEvent('invoiceClosed', {\n                url: invoiceData.url,\n                status: eventData.status\n            });\n        }\n    }\n    var webAppPopupOpened = false;\n    function onPopupClosed(eventType, eventData) {\n        if (webAppPopupOpened) {\n            var popupData = webAppPopupOpened;\n            webAppPopupOpened = false;\n            var button_id = null;\n            if (typeof eventData.button_id !== 'undefined') {\n                button_id = eventData.button_id;\n            }\n            if (popupData.callback) {\n                popupData.callback(button_id);\n            }\n            receiveWebViewEvent('popupClosed', {\n                button_id: button_id\n            });\n        }\n    }\n    var webAppScanQrPopupOpened = false;\n    function onQrTextReceived(eventType, eventData) {\n        if (webAppScanQrPopupOpened) {\n            var popupData = webAppScanQrPopupOpened;\n            var data = null;\n            if (typeof eventData.data !== 'undefined') {\n                data = eventData.data;\n            }\n            if (popupData.callback) {\n                if (popupData.callback(data)) {\n                    webAppScanQrPopupOpened = false;\n                    WebView.postEvent('web_app_close_scan_qr_popup', false);\n                }\n            }\n            receiveWebViewEvent('qrTextReceived', {\n                data: data\n            });\n        }\n    }\n    function onScanQrPopupClosed(eventType, eventData) {\n        webAppScanQrPopupOpened = false;\n    }\n    function onClipboardTextReceived(eventType, eventData) {\n        if (eventData.req_id && webAppCallbacks[eventData.req_id]) {\n            var requestData = webAppCallbacks[eventData.req_id];\n            delete webAppCallbacks[eventData.req_id];\n            var data = null;\n            if (typeof eventData.data !== 'undefined') {\n                data = eventData.data;\n            }\n            if (requestData.callback) {\n                requestData.callback(data);\n            }\n            receiveWebViewEvent('clipboardTextReceived', {\n                data: data\n            });\n        }\n    }\n    var WebAppWriteAccessRequested = false;\n    function onWriteAccessRequested(eventType, eventData) {\n        if (WebAppWriteAccessRequested) {\n            var requestData = WebAppWriteAccessRequested;\n            WebAppWriteAccessRequested = false;\n            if (requestData.callback) {\n                requestData.callback(eventData.status == 'allowed');\n            }\n            receiveWebViewEvent('writeAccessRequested', {\n                status: eventData.status\n            });\n        }\n    }\n    function getRequestedContact(callback, timeout) {\n        var reqTo, fallbackTo, reqDelay = 0;\n        var reqInvoke = function () {\n            invokeCustomMethod('getRequestedContact', {}, function (err, res) {\n                if (res && res.length) {\n                    clearTimeout(fallbackTo);\n                    callback(res);\n                }\n                else {\n                    reqDelay += 50;\n                    reqTo = setTimeout(reqInvoke, reqDelay);\n                }\n            });\n        };\n        var fallbackInvoke = function () {\n            clearTimeout(reqTo);\n            callback('');\n        };\n        fallbackTo = setTimeout(fallbackInvoke, timeout);\n        reqInvoke();\n    }\n    var WebAppContactRequested = false;\n    function onPhoneRequested(eventType, eventData) {\n        if (WebAppContactRequested) {\n            var requestData = WebAppContactRequested;\n            WebAppContactRequested = false;\n            var requestSent = eventData.status == 'sent';\n            var webViewEvent = {\n                status: eventData.status\n            };\n            if (requestSent) {\n                getRequestedContact(function (res) {\n                    if (res && res.length) {\n                        webViewEvent.response = res;\n                        webViewEvent.responseUnsafe = Utils.urlParseQueryString(res);\n                        for (var key in webViewEvent.responseUnsafe) {\n                            var val = webViewEvent.responseUnsafe[key];\n                            try {\n                                if (val.substr(0, 1) == '{' && val.substr(-1) == '}' ||\n                                    val.substr(0, 1) == '[' && val.substr(-1) == ']') {\n                                    webViewEvent.responseUnsafe[key] = JSON.parse(val);\n                                }\n                            }\n                            catch (e) { }\n                        }\n                    }\n                    if (requestData.callback) {\n                        requestData.callback(requestSent, webViewEvent);\n                    }\n                    receiveWebViewEvent('contactRequested', webViewEvent);\n                }, 3000);\n            }\n            else {\n                if (requestData.callback) {\n                    requestData.callback(requestSent, webViewEvent);\n                }\n                receiveWebViewEvent('contactRequested', webViewEvent);\n            }\n        }\n    }\n    function onCustomMethodInvoked(eventType, eventData) {\n        if (eventData.req_id && webAppCallbacks[eventData.req_id]) {\n            var requestData = webAppCallbacks[eventData.req_id];\n            delete webAppCallbacks[eventData.req_id];\n            var res = null, err = null;\n            if (typeof eventData.result !== 'undefined') {\n                res = eventData.result;\n            }\n            if (typeof eventData.error !== 'undefined') {\n                err = eventData.error;\n            }\n            if (requestData.callback) {\n                requestData.callback(err, res);\n            }\n        }\n    }\n    function invokeCustomMethod(method, params, callback) {\n        if (!versionAtLeast('6.9')) {\n            console.error('[Telegram.WebApp] Method invokeCustomMethod is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        var req_id = generateCallbackId(16);\n        var req_params = { req_id: req_id, method: method, params: params || {} };\n        webAppCallbacks[req_id] = {\n            callback: callback\n        };\n        WebView.postEvent('web_app_invoke_custom_method', false, req_params);\n    }\n    ;\n    if (!window.Telegram) {\n        window.Telegram = {};\n    }\n    Object.defineProperty(WebApp, 'initData', {\n        get: function () { return webAppInitData; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'initDataUnsafe', {\n        get: function () { return webAppInitDataUnsafe; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'version', {\n        get: function () { return webAppVersion; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'platform', {\n        get: function () { return webAppPlatform; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'colorScheme', {\n        get: function () { return colorScheme; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'themeParams', {\n        get: function () { return themeParams; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'isExpanded', {\n        get: function () { return isExpanded; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'viewportHeight', {\n        get: function () { return (viewportHeight === false ? window.innerHeight : viewportHeight) - mainButtonHeight; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'viewportStableHeight', {\n        get: function () { return (viewportStableHeight === false ? window.innerHeight : viewportStableHeight) - mainButtonHeight; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'isClosingConfirmationEnabled', {\n        set: function (val) { setClosingConfirmation(val); },\n        get: function () { return isClosingConfirmationEnabled; },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'headerColor', {\n        set: function (val) { setHeaderColor(val); },\n        get: function () { return getHeaderColor(); },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'backgroundColor', {\n        set: function (val) { setBackgroundColor(val); },\n        get: function () { return getBackgroundColor(); },\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'BackButton', {\n        value: BackButton,\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'MainButton', {\n        value: MainButton,\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'SettingsButton', {\n        value: SettingsButton,\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'HapticFeedback', {\n        value: HapticFeedback,\n        enumerable: true\n    });\n    Object.defineProperty(WebApp, 'CloudStorage', {\n        value: CloudStorage,\n        enumerable: true\n    });\n    WebApp.setHeaderColor = function (color_key) {\n        WebApp.headerColor = color_key;\n    };\n    WebApp.setBackgroundColor = function (color) {\n        WebApp.backgroundColor = color;\n    };\n    WebApp.enableClosingConfirmation = function () {\n        WebApp.isClosingConfirmationEnabled = true;\n    };\n    WebApp.disableClosingConfirmation = function () {\n        WebApp.isClosingConfirmationEnabled = false;\n    };\n    WebApp.isVersionAtLeast = function (ver) {\n        return versionAtLeast(ver);\n    };\n    WebApp.onEvent = function (eventType, callback) {\n        onWebViewEvent(eventType, callback);\n    };\n    WebApp.offEvent = function (eventType, callback) {\n        offWebViewEvent(eventType, callback);\n    };\n    WebApp.sendData = function (data) {\n        if (!data || !data.length) {\n            console.error('[Telegram.WebApp] Data is required', data);\n            throw Error('WebAppDataInvalid');\n        }\n        if (byteLength(data) > 4096) {\n            console.error('[Telegram.WebApp] Data is too long', data);\n            throw Error('WebAppDataInvalid');\n        }\n        WebView.postEvent('web_app_data_send', false, { data: data });\n    };\n    WebApp.switchInlineQuery = function (query, choose_chat_types) {\n        if (!versionAtLeast('6.6')) {\n            console.error('[Telegram.WebApp] Method switchInlineQuery is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        if (!initParams.tgWebAppBotInline) {\n            console.error('[Telegram.WebApp] Inline mode is disabled for this bot. Read more about inline mode: https://core.telegram.org/bots/inline');\n            throw Error('WebAppInlineModeDisabled');\n        }\n        query = query || '';\n        if (query.length > 256) {\n            console.error('[Telegram.WebApp] Inline query is too long', query);\n            throw Error('WebAppInlineQueryInvalid');\n        }\n        var chat_types = [];\n        if (choose_chat_types) {\n            if (!Array.isArray(choose_chat_types)) {\n                console.error('[Telegram.WebApp] Choose chat types should be an array', choose_chat_types);\n                throw Error('WebAppInlineChooseChatTypesInvalid');\n            }\n            var good_types = { users: 1, bots: 1, groups: 1, channels: 1 };\n            for (var i = 0; i < choose_chat_types.length; i++) {\n                var chat_type = choose_chat_types[i];\n                if (!good_types[chat_type]) {\n                    console.error('[Telegram.WebApp] Choose chat type is invalid', chat_type);\n                    throw Error('WebAppInlineChooseChatTypeInvalid');\n                }\n                if (good_types[chat_type] != 2) {\n                    good_types[chat_type] = 2;\n                    chat_types.push(chat_type);\n                }\n            }\n        }\n        WebView.postEvent('web_app_switch_inline_query', false, { query: query, chat_types: chat_types });\n    };\n    WebApp.openLink = function (url, options) {\n        var a = document.createElement('A');\n        a.href = url;\n        if (a.protocol != 'http:' &&\n            a.protocol != 'https:') {\n            console.error('[Telegram.WebApp] Url protocol is not supported', url);\n            throw Error('WebAppTgUrlInvalid');\n        }\n        var url = a.href;\n        options = options || {};\n        if (versionAtLeast('6.1')) {\n            WebView.postEvent('web_app_open_link', false, { url: url, try_instant_view: versionAtLeast('6.4') && !!options.try_instant_view });\n        }\n        else {\n            window.open(url, '_blank');\n        }\n    };\n    WebApp.openTelegramLink = function (url) {\n        var a = document.createElement('A');\n        a.href = url;\n        if (a.protocol != 'http:' &&\n            a.protocol != 'https:') {\n            console.error('[Telegram.WebApp] Url protocol is not supported', url);\n            throw Error('WebAppTgUrlInvalid');\n        }\n        if (a.hostname != 't.me') {\n            console.error('[Telegram.WebApp] Url host is not supported', url);\n            throw Error('WebAppTgUrlInvalid');\n        }\n        var path_full = a.pathname + a.search;\n        if (isIframe || versionAtLeast('6.1')) {\n            WebView.postEvent('web_app_open_tg_link', false, { path_full: path_full });\n        }\n        else {\n            location.href = 'https://t.me' + path_full;\n        }\n    };\n    WebApp.openInvoice = function (url, callback) {\n        var a = document.createElement('A'), match, slug;\n        a.href = url;\n        if (a.protocol != 'http:' &&\n            a.protocol != 'https:' ||\n            a.hostname != 't.me' ||\n            !(match = a.pathname.match(/^\\/(\\$|invoice\\/)([A-Za-z0-9\\-_=]+)$/)) ||\n            !(slug = match[2])) {\n            console.error('[Telegram.WebApp] Invoice url is invalid', url);\n            throw Error('WebAppInvoiceUrlInvalid');\n        }\n        if (!versionAtLeast('6.1')) {\n            console.error('[Telegram.WebApp] Method openInvoice is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        if (webAppInvoices[slug]) {\n            console.error('[Telegram.WebApp] Invoice is already opened');\n            throw Error('WebAppInvoiceOpened');\n        }\n        webAppInvoices[slug] = {\n            url: url,\n            callback: callback\n        };\n        WebView.postEvent('web_app_open_invoice', false, { slug: slug });\n    };\n    WebApp.showPopup = function (params, callback) {\n        if (!versionAtLeast('6.2')) {\n            console.error('[Telegram.WebApp] Method showPopup is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        if (webAppPopupOpened) {\n            console.error('[Telegram.WebApp] Popup is already opened');\n            throw Error('WebAppPopupOpened');\n        }\n        var title = '';\n        var message = '';\n        var buttons = [];\n        var popup_buttons = {};\n        var popup_params = {};\n        if (typeof params.title !== 'undefined') {\n            title = strTrim(params.title);\n            if (title.length > 64) {\n                console.error('[Telegram.WebApp] Popup title is too long', title);\n                throw Error('WebAppPopupParamInvalid');\n            }\n            if (title.length > 0) {\n                popup_params.title = title;\n            }\n        }\n        if (typeof params.message !== 'undefined') {\n            message = strTrim(params.message);\n        }\n        if (!message.length) {\n            console.error('[Telegram.WebApp] Popup message is required', params.message);\n            throw Error('WebAppPopupParamInvalid');\n        }\n        if (message.length > 256) {\n            console.error('[Telegram.WebApp] Popup message is too long', message);\n            throw Error('WebAppPopupParamInvalid');\n        }\n        popup_params.message = message;\n        if (typeof params.buttons !== 'undefined') {\n            if (!Array.isArray(params.buttons)) {\n                console.error('[Telegram.WebApp] Popup buttons should be an array', params.buttons);\n                throw Error('WebAppPopupParamInvalid');\n            }\n            for (var i = 0; i < params.buttons.length; i++) {\n                var button = params.buttons[i];\n                var btn = {};\n                var id = '';\n                if (typeof button.id !== 'undefined') {\n                    id = button.id.toString();\n                    if (id.length > 64) {\n                        console.error('[Telegram.WebApp] Popup button id is too long', id);\n                        throw Error('WebAppPopupParamInvalid');\n                    }\n                }\n                btn.id = id;\n                var button_type = button.type;\n                if (typeof button_type === 'undefined') {\n                    button_type = 'default';\n                }\n                btn.type = button_type;\n                if (button_type == 'ok' ||\n                    button_type == 'close' ||\n                    button_type == 'cancel') {\n                    // no params needed\n                }\n                else if (button_type == 'default' ||\n                    button_type == 'destructive') {\n                    var text = '';\n                    if (typeof button.text !== 'undefined') {\n                        text = strTrim(button.text);\n                    }\n                    if (!text.length) {\n                        console.error('[Telegram.WebApp] Popup button text is required for type ' + button_type, button.text);\n                        throw Error('WebAppPopupParamInvalid');\n                    }\n                    if (text.length > 64) {\n                        console.error('[Telegram.WebApp] Popup button text is too long', text);\n                        throw Error('WebAppPopupParamInvalid');\n                    }\n                    btn.text = text;\n                }\n                else {\n                    console.error('[Telegram.WebApp] Popup button type is invalid', button_type);\n                    throw Error('WebAppPopupParamInvalid');\n                }\n                buttons.push(btn);\n            }\n        }\n        else {\n            buttons.push({ id: '', type: 'close' });\n        }\n        if (buttons.length < 1) {\n            console.error('[Telegram.WebApp] Popup should have at least one button');\n            throw Error('WebAppPopupParamInvalid');\n        }\n        if (buttons.length > 3) {\n            console.error('[Telegram.WebApp] Popup should not have more than 3 buttons');\n            throw Error('WebAppPopupParamInvalid');\n        }\n        popup_params.buttons = buttons;\n        webAppPopupOpened = {\n            callback: callback\n        };\n        WebView.postEvent('web_app_open_popup', false, popup_params);\n    };\n    WebApp.showAlert = function (message, callback) {\n        WebApp.showPopup({\n            message: message\n        }, callback ? function () { callback(); } : null);\n    };\n    WebApp.showConfirm = function (message, callback) {\n        WebApp.showPopup({\n            message: message,\n            buttons: [\n                { type: 'ok', id: 'ok' },\n                { type: 'cancel' }\n            ]\n        }, callback ? function (button_id) {\n            callback(button_id == 'ok');\n        } : null);\n    };\n    WebApp.showScanQrPopup = function (params, callback) {\n        if (!versionAtLeast('6.4')) {\n            console.error('[Telegram.WebApp] Method showScanQrPopup is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        if (webAppScanQrPopupOpened) {\n            console.error('[Telegram.WebApp] Popup is already opened');\n            throw Error('WebAppScanQrPopupOpened');\n        }\n        var text = '';\n        var popup_params = {};\n        if (typeof params.text !== 'undefined') {\n            text = strTrim(params.text);\n            if (text.length > 64) {\n                console.error('[Telegram.WebApp] Scan QR popup text is too long', text);\n                throw Error('WebAppScanQrPopupParamInvalid');\n            }\n            if (text.length > 0) {\n                popup_params.text = text;\n            }\n        }\n        webAppScanQrPopupOpened = {\n            callback: callback\n        };\n        WebView.postEvent('web_app_open_scan_qr_popup', false, popup_params);\n    };\n    WebApp.closeScanQrPopup = function () {\n        if (!versionAtLeast('6.4')) {\n            console.error('[Telegram.WebApp] Method closeScanQrPopup is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        webAppScanQrPopupOpened = false;\n        WebView.postEvent('web_app_close_scan_qr_popup', false);\n    };\n    WebApp.readTextFromClipboard = function (callback) {\n        if (!versionAtLeast('6.4')) {\n            console.error('[Telegram.WebApp] Method readTextFromClipboard is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        var req_id = generateCallbackId(16);\n        var req_params = { req_id: req_id };\n        webAppCallbacks[req_id] = {\n            callback: callback\n        };\n        WebView.postEvent('web_app_read_text_from_clipboard', false, req_params);\n    };\n    WebApp.requestWriteAccess = function (callback) {\n        if (!versionAtLeast('6.9')) {\n            console.error('[Telegram.WebApp] Method requestWriteAccess is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        if (WebAppWriteAccessRequested) {\n            console.error('[Telegram.WebApp] Write access is already requested');\n            throw Error('WebAppWriteAccessRequested');\n        }\n        WebAppWriteAccessRequested = {\n            callback: callback\n        };\n        WebView.postEvent('web_app_request_write_access');\n    };\n    WebApp.requestContact = function (callback) {\n        if (!versionAtLeast('6.9')) {\n            console.error('[Telegram.WebApp] Method requestContact is not supported in version ' + webAppVersion);\n            throw Error('WebAppMethodUnsupported');\n        }\n        if (WebAppContactRequested) {\n            console.error('[Telegram.WebApp] Contact is already requested');\n            throw Error('WebAppContactRequested');\n        }\n        WebAppContactRequested = {\n            callback: callback\n        };\n        WebView.postEvent('web_app_request_phone');\n    };\n    WebApp.invokeCustomMethod = function (method, params, callback) {\n        invokeCustomMethod(method, params, callback);\n    };\n    WebApp.ready = function () {\n        WebView.postEvent('web_app_ready');\n    };\n    WebApp.expand = function () {\n        WebView.postEvent('web_app_expand');\n    };\n    WebApp.close = function () {\n        WebView.postEvent('web_app_close');\n    };\n    window.Telegram.WebApp = WebApp;\n    updateHeaderColor();\n    updateBackgroundColor();\n    setViewportHeight();\n    if (initParams.tgWebAppShowSettings) {\n        SettingsButton.show();\n    }\n    window.addEventListener('resize', onWindowResize);\n    if (isIframe) {\n        document.addEventListener('click', linkHandler);\n    }\n    WebView.onEvent('theme_changed', onThemeChanged);\n    WebView.onEvent('viewport_changed', onViewportChanged);\n    WebView.onEvent('invoice_closed', onInvoiceClosed);\n    WebView.onEvent('popup_closed', onPopupClosed);\n    WebView.onEvent('qr_text_received', onQrTextReceived);\n    WebView.onEvent('scan_qr_popup_closed', onScanQrPopupClosed);\n    WebView.onEvent('clipboard_text_received', onClipboardTextReceived);\n    WebView.onEvent('write_access_requested', onWriteAccessRequested);\n    WebView.onEvent('phone_requested', onPhoneRequested);\n    WebView.onEvent('custom_method_invoked', onCustomMethodInvoked);\n    WebView.postEvent('web_app_request_theme');\n    WebView.postEvent('web_app_request_viewport');\n})();\n//# sourceMappingURL=telegram-web-apps.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AdHdhLWRldi9zZGsvZGlzdC90ZWxlZ3JhbS13ZWItYXBwcy5qcyIsIm1hcHBpbmdzIjoiQUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUUsaUNBQWlDO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLDJEQUEyRCx3Q0FBd0MsMEJBQTBCO0FBQzdIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDhCQUE4QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsNENBQTRDO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkRBQTJELDRDQUE0QztBQUN2RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixvQkFBb0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsNkJBQTZCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyx5QkFBeUI7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBEO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLFNBQVM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUVBQXFFLGlEQUFpRDtBQUN0SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsb0JBQW9CO0FBQzNGO0FBQ0E7QUFDQSx1RUFBdUUsMkJBQTJCO0FBQ2xHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUVBQXVFLGNBQWM7QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxFQUFFO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwRUFBMEUsSUFBSTtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsT0FBTztBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsUUFBUTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLFlBQVksaUJBQWlCLElBQUk7QUFDbkUsK0JBQStCLG1CQUFtQjtBQUNsRDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isa0JBQWtCO0FBQ2pEO0FBQ0E7QUFDQSwrQkFBK0IsbUJBQW1CO0FBQ2xEO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsdUJBQXVCLFdBQVcsSUFBSTtBQUN4RSwrQkFBK0Isb0JBQW9CO0FBQ25EO0FBQ0EsU0FBUztBQUNUO0FBQ0Esa0NBQWtDLHVCQUF1QixZQUFZLElBQUk7QUFDekUsK0JBQStCLDhEQUE4RDtBQUM3RjtBQUNBLFNBQVM7QUFDVDtBQUNBLGtDQUFrQyx1QkFBdUIsaUJBQWlCLElBQUk7QUFDOUUsK0JBQStCLHVFQUF1RTtBQUN0RztBQUNBLFNBQVM7QUFDVDtBQUNBLGtDQUFrQyx1QkFBdUIsaUJBQWlCLElBQUk7QUFDOUUsK0JBQStCLG1CQUFtQjtBQUNsRDtBQUNBLFNBQVM7QUFDVDtBQUNBLCtCQUErQiwyQkFBMkI7QUFDMUQ7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxrQ0FBa0MsdUJBQXVCLGdCQUFnQixJQUFJO0FBQzdFLCtCQUErQixrQkFBa0I7QUFDakQ7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsSUFBSTtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxZQUFZO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGtCQUFrQjtBQUM1RDtBQUNBO0FBQ0EsMENBQTBDLG1CQUFtQjtBQUM3RDtBQUNBO0FBQ0EsMENBQTBDLGlCQUFpQjtBQUMzRDtBQUNBO0FBQ0EsMENBQTBDLGtCQUFrQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLFlBQVksaUJBQWlCLElBQUk7QUFDbkUsK0JBQStCLG1CQUFtQjtBQUNsRDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isa0JBQWtCO0FBQ2pEO0FBQ0E7QUFDQSwrQkFBK0IsbUJBQW1CO0FBQ2xEO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLHFDQUFxQztBQUMxRTtBQUNBO0FBQ0EscUNBQXFDLCtDQUErQztBQUNwRjtBQUNBO0FBQ0EscUNBQXFDLDBCQUEwQjtBQUMvRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQsd0JBQXdCO0FBQ3JGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQSw2REFBNkQsWUFBWTtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLFlBQVk7QUFDNUU7QUFDQTtBQUNBLDJEQUEyRDtBQUMzRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RDtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMERBQTBELHlCQUF5QjtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHdCQUF3QjtBQUNuRDtBQUNBLEtBQUs7QUFDTDtBQUNBLDJCQUEyQiw4QkFBOEI7QUFDekQ7QUFDQSxLQUFLO0FBQ0w7QUFDQSwyQkFBMkIsdUJBQXVCO0FBQ2xEO0FBQ0EsS0FBSztBQUNMO0FBQ0EsMkJBQTJCLHdCQUF3QjtBQUNuRDtBQUNBLEtBQUs7QUFDTDtBQUNBLDJCQUEyQixxQkFBcUI7QUFDaEQ7QUFDQSxLQUFLO0FBQ0w7QUFDQSwyQkFBMkIscUJBQXFCO0FBQ2hEO0FBQ0EsS0FBSztBQUNMO0FBQ0EsMkJBQTJCLG9CQUFvQjtBQUMvQztBQUNBLEtBQUs7QUFDTDtBQUNBLDJCQUEyQiw2RkFBNkY7QUFDeEg7QUFDQSxLQUFLO0FBQ0w7QUFDQSwyQkFBMkIseUdBQXlHO0FBQ3BJO0FBQ0EsS0FBSztBQUNMO0FBQ0EsOEJBQThCLDhCQUE4QjtBQUM1RCwyQkFBMkIsc0NBQXNDO0FBQ2pFO0FBQ0EsS0FBSztBQUNMO0FBQ0EsOEJBQThCLHNCQUFzQjtBQUNwRCwyQkFBMkIsMEJBQTBCO0FBQ3JEO0FBQ0EsS0FBSztBQUNMO0FBQ0EsOEJBQThCLDBCQUEwQjtBQUN4RCwyQkFBMkIsOEJBQThCO0FBQ3pEO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELFlBQVk7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CLDRCQUE0Qiw4QkFBOEI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRSxzQ0FBc0M7QUFDeEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELGlGQUFpRjtBQUM3STtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCxzQkFBc0I7QUFDckY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsWUFBWTtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkJBQTJCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix1QkFBdUI7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUywyQkFBMkIsY0FBYztBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLHNCQUFzQjtBQUN4QyxrQkFBa0I7QUFDbEI7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL25vZGVfbW9kdWxlcy9AdHdhLWRldi9zZGsvZGlzdC90ZWxlZ3JhbS13ZWItYXBwcy5qcz85YTkwIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLy8gV2ViVmlld1xuKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXZlbnRIYW5kbGVycyA9IHt9O1xuICAgIHZhciBsb2NhdGlvbkhhc2ggPSAnJztcbiAgICB0cnkge1xuICAgICAgICBsb2NhdGlvbkhhc2ggPSBsb2NhdGlvbi5oYXNoLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbiAgICB2YXIgaW5pdFBhcmFtcyA9IHVybFBhcnNlSGFzaFBhcmFtcyhsb2NhdGlvbkhhc2gpO1xuICAgIHZhciBzdG9yZWRQYXJhbXMgPSBzZXNzaW9uU3RvcmFnZUdldCgnaW5pdFBhcmFtcycpO1xuICAgIGlmIChzdG9yZWRQYXJhbXMpIHtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHN0b3JlZFBhcmFtcykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbml0UGFyYW1zW2tleV0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgaW5pdFBhcmFtc1trZXldID0gc3RvcmVkUGFyYW1zW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2Vzc2lvblN0b3JhZ2VTZXQoJ2luaXRQYXJhbXMnLCBpbml0UGFyYW1zKTtcbiAgICB2YXIgaXNJZnJhbWUgPSBmYWxzZSwgaUZyYW1lU3R5bGU7XG4gICAgdHJ5IHtcbiAgICAgICAgaXNJZnJhbWUgPSAod2luZG93LnBhcmVudCAhPSBudWxsICYmIHdpbmRvdyAhPSB3aW5kb3cucGFyZW50KTtcbiAgICAgICAgaWYgKGlzSWZyYW1lKSB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGlmIChldmVudC5zb3VyY2UgIT09IHdpbmRvdy5wYXJlbnQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YVBhcnNlZCA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFkYXRhUGFyc2VkIHx8ICFkYXRhUGFyc2VkLmV2ZW50VHlwZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkYXRhUGFyc2VkLmV2ZW50VHlwZSA9PSAnc2V0X2N1c3RvbV9zdHlsZScpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm9yaWdpbiA9PT0gJ2h0dHBzOi8vd2ViLnRlbGVncmFtLm9yZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlGcmFtZVN0eWxlLmlubmVySFRNTCA9IGRhdGFQYXJzZWQuZXZlbnREYXRhO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRhdGFQYXJzZWQuZXZlbnRUeXBlID09ICdyZWxvYWRfaWZyYW1lJykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeSh7IGV2ZW50VHlwZTogJ2lmcmFtZV93aWxsX3JlbG9hZCcgfSksICcqJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlY2VpdmVFdmVudChkYXRhUGFyc2VkLmV2ZW50VHlwZSwgZGF0YVBhcnNlZC5ldmVudERhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaUZyYW1lU3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChpRnJhbWVTdHlsZSk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoeyBldmVudFR5cGU6ICdpZnJhbWVfcmVhZHknLCBldmVudERhdGE6IHsgcmVsb2FkX3N1cHBvcnRlZDogdHJ1ZSB9IH0pLCAnKicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7IH1cbiAgICBmdW5jdGlvbiB1cmxTYWZlRGVjb2RlKHVybGVuY29kZWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHVybGVuY29kZWQgPSB1cmxlbmNvZGVkLnJlcGxhY2UoL1xcKy9nLCAnJTIwJyk7XG4gICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHVybGVuY29kZWQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gdXJsZW5jb2RlZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiB1cmxQYXJzZUhhc2hQYXJhbXMobG9jYXRpb25IYXNoKSB7XG4gICAgICAgIGxvY2F0aW9uSGFzaCA9IGxvY2F0aW9uSGFzaC5yZXBsYWNlKC9eIy8sICcnKTtcbiAgICAgICAgdmFyIHBhcmFtcyA9IHt9O1xuICAgICAgICBpZiAoIWxvY2F0aW9uSGFzaC5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxvY2F0aW9uSGFzaC5pbmRleE9mKCc9JykgPCAwICYmIGxvY2F0aW9uSGFzaC5pbmRleE9mKCc/JykgPCAwKSB7XG4gICAgICAgICAgICBwYXJhbXMuX3BhdGggPSB1cmxTYWZlRGVjb2RlKGxvY2F0aW9uSGFzaCk7XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9XG4gICAgICAgIHZhciBxSW5kZXggPSBsb2NhdGlvbkhhc2guaW5kZXhPZignPycpO1xuICAgICAgICBpZiAocUluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHZhciBwYXRoUGFyYW0gPSBsb2NhdGlvbkhhc2guc3Vic3RyKDAsIHFJbmRleCk7XG4gICAgICAgICAgICBwYXJhbXMuX3BhdGggPSB1cmxTYWZlRGVjb2RlKHBhdGhQYXJhbSk7XG4gICAgICAgICAgICBsb2NhdGlvbkhhc2ggPSBsb2NhdGlvbkhhc2guc3Vic3RyKHFJbmRleCArIDEpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBxdWVyeV9wYXJhbXMgPSB1cmxQYXJzZVF1ZXJ5U3RyaW5nKGxvY2F0aW9uSGFzaCk7XG4gICAgICAgIGZvciAodmFyIGsgaW4gcXVlcnlfcGFyYW1zKSB7XG4gICAgICAgICAgICBwYXJhbXNba10gPSBxdWVyeV9wYXJhbXNba107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICB9XG4gICAgZnVuY3Rpb24gdXJsUGFyc2VRdWVyeVN0cmluZyhxdWVyeVN0cmluZykge1xuICAgICAgICB2YXIgcGFyYW1zID0ge307XG4gICAgICAgIGlmICghcXVlcnlTdHJpbmcubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgICAgICB9XG4gICAgICAgIHZhciBxdWVyeVN0cmluZ1BhcmFtcyA9IHF1ZXJ5U3RyaW5nLnNwbGl0KCcmJyk7XG4gICAgICAgIHZhciBpLCBwYXJhbSwgcGFyYW1OYW1lLCBwYXJhbVZhbHVlO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcXVlcnlTdHJpbmdQYXJhbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHBhcmFtID0gcXVlcnlTdHJpbmdQYXJhbXNbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgICAgIHBhcmFtTmFtZSA9IHVybFNhZmVEZWNvZGUocGFyYW1bMF0pO1xuICAgICAgICAgICAgcGFyYW1WYWx1ZSA9IHBhcmFtWzFdID09IG51bGwgPyBudWxsIDogdXJsU2FmZURlY29kZShwYXJhbVsxXSk7XG4gICAgICAgICAgICBwYXJhbXNbcGFyYW1OYW1lXSA9IHBhcmFtVmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICB9XG4gICAgLy8gVGVsZWdyYW0gYXBwcyB3aWxsIGltcGxlbWVudCB0aGlzIGxvZ2ljIHRvIGFkZCBzZXJ2aWNlIHBhcmFtcyAoZS5nLiB0Z1NoYXJlU2NvcmVVcmwpIHRvIGdhbWUgVVJMXG4gICAgZnVuY3Rpb24gdXJsQXBwZW5kSGFzaFBhcmFtcyh1cmwsIGFkZEhhc2gpIHtcbiAgICAgICAgLy8gdXJsIGxvb2tzIGxpa2UgJ2h0dHBzOi8vZ2FtZS5jb20vcGF0aD9xdWVyeT0xI2hhc2gnXG4gICAgICAgIC8vIGFkZEhhc2ggbG9va3MgbGlrZSAndGdTaGFyZVNjb3JlVXJsPScgKyBlbmNvZGVVUklDb21wb25lbnQoJ3RnYjovL3NoYXJlX2dhbWVfc2NvcmU/aGFzaD12ZXJ5X2xvbmdfaGFzaDEyMycpXG4gICAgICAgIHZhciBpbmQgPSB1cmwuaW5kZXhPZignIycpO1xuICAgICAgICBpZiAoaW5kIDwgMCkge1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9nYW1lLmNvbS9wYXRoIC0+IGh0dHBzOi8vZ2FtZS5jb20vcGF0aCN0Z1NoYXJlU2NvcmVVcmw9ZXRjXG4gICAgICAgICAgICByZXR1cm4gdXJsICsgJyMnICsgYWRkSGFzaDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY3VySGFzaCA9IHVybC5zdWJzdHIoaW5kICsgMSk7XG4gICAgICAgIGlmIChjdXJIYXNoLmluZGV4T2YoJz0nKSA+PSAwIHx8IGN1ckhhc2guaW5kZXhPZignPycpID49IDApIHtcbiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2FtZS5jb20vI2hhc2g9MSAtPiBodHRwczovL2dhbWUuY29tLyNoYXNoPTEmdGdTaGFyZVNjb3JlVXJsPWV0Y1xuICAgICAgICAgICAgLy8gaHR0cHM6Ly9nYW1lLmNvbS8jcGF0aD9xdWVyeSAtPiBodHRwczovL2dhbWUuY29tLyNwYXRoP3F1ZXJ5JnRnU2hhcmVTY29yZVVybD1ldGNcbiAgICAgICAgICAgIHJldHVybiB1cmwgKyAnJicgKyBhZGRIYXNoO1xuICAgICAgICB9XG4gICAgICAgIC8vIGh0dHBzOi8vZ2FtZS5jb20vI2hhc2ggLT4gaHR0cHM6Ly9nYW1lLmNvbS8jaGFzaD90Z1NoYXJlU2NvcmVVcmw9ZXRjXG4gICAgICAgIGlmIChjdXJIYXNoLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB1cmwgKyAnPycgKyBhZGRIYXNoO1xuICAgICAgICB9XG4gICAgICAgIC8vIGh0dHBzOi8vZ2FtZS5jb20vIyAtPiBodHRwczovL2dhbWUuY29tLyN0Z1NoYXJlU2NvcmVVcmw9ZXRjXG4gICAgICAgIHJldHVybiB1cmwgKyBhZGRIYXNoO1xuICAgIH1cbiAgICBmdW5jdGlvbiBwb3N0RXZlbnQoZXZlbnRUeXBlLCBjYWxsYmFjaywgZXZlbnREYXRhKSB7XG4gICAgICAgIGlmICghY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudERhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZXZlbnREYXRhID0gJyc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJ1tUZWxlZ3JhbS5XZWJWaWV3XSA+IHBvc3RFdmVudCcsIGV2ZW50VHlwZSwgZXZlbnREYXRhKTtcbiAgICAgICAgaWYgKHdpbmRvdy5UZWxlZ3JhbVdlYnZpZXdQcm94eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBUZWxlZ3JhbVdlYnZpZXdQcm94eS5wb3N0RXZlbnQoZXZlbnRUeXBlLCBKU09OLnN0cmluZ2lmeShldmVudERhdGEpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAod2luZG93LmV4dGVybmFsICYmICdub3RpZnknIGluIHdpbmRvdy5leHRlcm5hbCkge1xuICAgICAgICAgICAgd2luZG93LmV4dGVybmFsLm5vdGlmeShKU09OLnN0cmluZ2lmeSh7IGV2ZW50VHlwZTogZXZlbnRUeXBlLCBldmVudERhdGE6IGV2ZW50RGF0YSB9KSk7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzSWZyYW1lKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciB0cnVzdGVkVGFyZ2V0ID0gJ2h0dHBzOi8vd2ViLnRlbGVncmFtLm9yZyc7XG4gICAgICAgICAgICAgICAgLy8gRm9yIG5vdyB3ZSBkb24ndCByZXN0cmljdCB0YXJnZXQsIGZvciB0ZXN0aW5nIHB1cnBvc2VzXG4gICAgICAgICAgICAgICAgdHJ1c3RlZFRhcmdldCA9ICcqJztcbiAgICAgICAgICAgICAgICB3aW5kb3cucGFyZW50LnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHsgZXZlbnRUeXBlOiBldmVudFR5cGUsIGV2ZW50RGF0YTogZXZlbnREYXRhIH0pLCB0cnVzdGVkVGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHsgbm90QXZhaWxhYmxlOiB0cnVlIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIDtcbiAgICBmdW5jdGlvbiByZWNlaXZlRXZlbnQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tUZWxlZ3JhbS5XZWJWaWV3XSA8IHJlY2VpdmVFdmVudCcsIGV2ZW50VHlwZSwgZXZlbnREYXRhKTtcbiAgICAgICAgY2FsbEV2ZW50Q2FsbGJhY2tzKGV2ZW50VHlwZSwgZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhldmVudFR5cGUsIGV2ZW50RGF0YSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjYWxsRXZlbnRDYWxsYmFja3MoZXZlbnRUeXBlLCBmdW5jKSB7XG4gICAgICAgIHZhciBjdXJFdmVudEhhbmRsZXJzID0gZXZlbnRIYW5kbGVyc1tldmVudFR5cGVdO1xuICAgICAgICBpZiAoY3VyRXZlbnRIYW5kbGVycyA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICAgICAhY3VyRXZlbnRIYW5kbGVycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1ckV2ZW50SGFuZGxlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZnVuYyhjdXJFdmVudEhhbmRsZXJzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBvbkV2ZW50KGV2ZW50VHlwZSwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKGV2ZW50SGFuZGxlcnNbZXZlbnRUeXBlXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBldmVudEhhbmRsZXJzW2V2ZW50VHlwZV0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW5kZXggPSBldmVudEhhbmRsZXJzW2V2ZW50VHlwZV0uaW5kZXhPZihjYWxsYmFjayk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGV2ZW50SGFuZGxlcnNbZXZlbnRUeXBlXS5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICA7XG4gICAgZnVuY3Rpb24gb2ZmRXZlbnQoZXZlbnRUeXBlLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoZXZlbnRIYW5kbGVyc1tldmVudFR5cGVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW5kZXggPSBldmVudEhhbmRsZXJzW2V2ZW50VHlwZV0uaW5kZXhPZihjYWxsYmFjayk7XG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBldmVudEhhbmRsZXJzW2V2ZW50VHlwZV0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgO1xuICAgIGZ1bmN0aW9uIG9wZW5Qcm90b1VybCh1cmwpIHtcbiAgICAgICAgaWYgKCF1cmwubWF0Y2goL14od2ViXFwrKT90Z2I/OlxcL1xcLy4vKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciB1c2VJZnJhbWUgPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9pT1N8aVBob25lIE9TfGlQaG9uZXxpUG9kfGlQYWQvaSkgPyB0cnVlIDogZmFsc2U7XG4gICAgICAgIGlmICh1c2VJZnJhbWUpIHtcbiAgICAgICAgICAgIHZhciBpZnJhbWVDb250RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGdtZV9mcmFtZV9jb250JykgfHwgZG9jdW1lbnQuYm9keTtcbiAgICAgICAgICAgIHZhciBpZnJhbWVFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpO1xuICAgICAgICAgICAgaWZyYW1lQ29udEVsLmFwcGVuZENoaWxkKGlmcmFtZUVsKTtcbiAgICAgICAgICAgIHZhciBwYWdlSGlkZGVuID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgZW5hYmxlSGlkZGVuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHBhZ2VIaWRkZW4gPSB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwYWdlaGlkZScsIGVuYWJsZUhpZGRlbiwgZmFsc2UpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBlbmFibGVIaWRkZW4sIGZhbHNlKTtcbiAgICAgICAgICAgIGlmIChpZnJhbWVFbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmcmFtZUVsLnNyYyA9IHVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICghcGFnZUhpZGRlbikge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSB1cmw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdwYWdlaGlkZScsIGVuYWJsZUhpZGRlbiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgZW5hYmxlSGlkZGVuLCBmYWxzZSk7XG4gICAgICAgICAgICB9LCAyMDAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHVybDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2Vzc2lvblN0b3JhZ2VTZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ19fdGVsZWdyYW1fXycgKyBrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkgeyB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2Vzc2lvblN0b3JhZ2VHZXQoa2V5KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh3aW5kb3cuc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnX190ZWxlZ3JhbV9fJyArIGtleSkpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGlmICghd2luZG93LlRlbGVncmFtKSB7XG4gICAgICAgIHdpbmRvdy5UZWxlZ3JhbSA9IHt9O1xuICAgIH1cbiAgICB3aW5kb3cuVGVsZWdyYW0uV2ViVmlldyA9IHtcbiAgICAgICAgaW5pdFBhcmFtczogaW5pdFBhcmFtcyxcbiAgICAgICAgaXNJZnJhbWU6IGlzSWZyYW1lLFxuICAgICAgICBvbkV2ZW50OiBvbkV2ZW50LFxuICAgICAgICBvZmZFdmVudDogb2ZmRXZlbnQsXG4gICAgICAgIHBvc3RFdmVudDogcG9zdEV2ZW50LFxuICAgICAgICByZWNlaXZlRXZlbnQ6IHJlY2VpdmVFdmVudCxcbiAgICAgICAgY2FsbEV2ZW50Q2FsbGJhY2tzOiBjYWxsRXZlbnRDYWxsYmFja3NcbiAgICB9O1xuICAgIHdpbmRvdy5UZWxlZ3JhbS5VdGlscyA9IHtcbiAgICAgICAgdXJsU2FmZURlY29kZTogdXJsU2FmZURlY29kZSxcbiAgICAgICAgdXJsUGFyc2VRdWVyeVN0cmluZzogdXJsUGFyc2VRdWVyeVN0cmluZyxcbiAgICAgICAgdXJsUGFyc2VIYXNoUGFyYW1zOiB1cmxQYXJzZUhhc2hQYXJhbXMsXG4gICAgICAgIHVybEFwcGVuZEhhc2hQYXJhbXM6IHVybEFwcGVuZEhhc2hQYXJhbXMsXG4gICAgICAgIHNlc3Npb25TdG9yYWdlU2V0OiBzZXNzaW9uU3RvcmFnZVNldCxcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2VHZXQ6IHNlc3Npb25TdG9yYWdlR2V0XG4gICAgfTtcbiAgICAvLyBGb3IgV2luZG93cyBQaG9uZSBhcHBcbiAgICB3aW5kb3cuVGVsZWdyYW1HYW1lUHJveHlfcmVjZWl2ZUV2ZW50ID0gcmVjZWl2ZUV2ZW50O1xuICAgIC8vIEFwcCBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgd2luZG93LlRlbGVncmFtR2FtZVByb3h5ID0ge1xuICAgICAgICByZWNlaXZlRXZlbnQ6IHJlY2VpdmVFdmVudFxuICAgIH07XG59KSgpO1xuLy8gV2ViQXBwXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBVdGlscyA9IHdpbmRvdy5UZWxlZ3JhbS5VdGlscztcbiAgICB2YXIgV2ViVmlldyA9IHdpbmRvdy5UZWxlZ3JhbS5XZWJWaWV3O1xuICAgIHZhciBpbml0UGFyYW1zID0gV2ViVmlldy5pbml0UGFyYW1zO1xuICAgIHZhciBpc0lmcmFtZSA9IFdlYlZpZXcuaXNJZnJhbWU7XG4gICAgdmFyIFdlYkFwcCA9IHt9O1xuICAgIHZhciB3ZWJBcHBJbml0RGF0YSA9ICcnLCB3ZWJBcHBJbml0RGF0YVVuc2FmZSA9IHt9O1xuICAgIHZhciB0aGVtZVBhcmFtcyA9IHt9LCBjb2xvclNjaGVtZSA9ICdsaWdodCc7XG4gICAgdmFyIHdlYkFwcFZlcnNpb24gPSAnNi4wJztcbiAgICB2YXIgd2ViQXBwUGxhdGZvcm0gPSAndW5rbm93bic7XG4gICAgaWYgKGluaXRQYXJhbXMudGdXZWJBcHBEYXRhICYmIGluaXRQYXJhbXMudGdXZWJBcHBEYXRhLmxlbmd0aCkge1xuICAgICAgICB3ZWJBcHBJbml0RGF0YSA9IGluaXRQYXJhbXMudGdXZWJBcHBEYXRhO1xuICAgICAgICB3ZWJBcHBJbml0RGF0YVVuc2FmZSA9IFV0aWxzLnVybFBhcnNlUXVlcnlTdHJpbmcod2ViQXBwSW5pdERhdGEpO1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gd2ViQXBwSW5pdERhdGFVbnNhZmUpIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSB3ZWJBcHBJbml0RGF0YVVuc2FmZVtrZXldO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAodmFsLnN1YnN0cigwLCAxKSA9PSAneycgJiYgdmFsLnN1YnN0cigtMSkgPT0gJ30nIHx8XG4gICAgICAgICAgICAgICAgICAgIHZhbC5zdWJzdHIoMCwgMSkgPT0gJ1snICYmIHZhbC5zdWJzdHIoLTEpID09ICddJykge1xuICAgICAgICAgICAgICAgICAgICB3ZWJBcHBJbml0RGF0YVVuc2FmZVtrZXldID0gSlNPTi5wYXJzZSh2YWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoaW5pdFBhcmFtcy50Z1dlYkFwcFRoZW1lUGFyYW1zICYmIGluaXRQYXJhbXMudGdXZWJBcHBUaGVtZVBhcmFtcy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIHRoZW1lUGFyYW1zUmF3ID0gaW5pdFBhcmFtcy50Z1dlYkFwcFRoZW1lUGFyYW1zO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHRoZW1lX3BhcmFtcyA9IEpTT04ucGFyc2UodGhlbWVQYXJhbXNSYXcpO1xuICAgICAgICAgICAgaWYgKHRoZW1lX3BhcmFtcykge1xuICAgICAgICAgICAgICAgIHNldFRoZW1lUGFyYW1zKHRoZW1lX3BhcmFtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgIH1cbiAgICB2YXIgdGhlbWVfcGFyYW1zID0gVXRpbHMuc2Vzc2lvblN0b3JhZ2VHZXQoJ3RoZW1lUGFyYW1zJyk7XG4gICAgaWYgKHRoZW1lX3BhcmFtcykge1xuICAgICAgICBzZXRUaGVtZVBhcmFtcyh0aGVtZV9wYXJhbXMpO1xuICAgIH1cbiAgICBpZiAoaW5pdFBhcmFtcy50Z1dlYkFwcFZlcnNpb24pIHtcbiAgICAgICAgd2ViQXBwVmVyc2lvbiA9IGluaXRQYXJhbXMudGdXZWJBcHBWZXJzaW9uO1xuICAgIH1cbiAgICBpZiAoaW5pdFBhcmFtcy50Z1dlYkFwcFBsYXRmb3JtKSB7XG4gICAgICAgIHdlYkFwcFBsYXRmb3JtID0gaW5pdFBhcmFtcy50Z1dlYkFwcFBsYXRmb3JtO1xuICAgIH1cbiAgICBmdW5jdGlvbiBvblRoZW1lQ2hhbmdlZChldmVudFR5cGUsIGV2ZW50RGF0YSkge1xuICAgICAgICBpZiAoZXZlbnREYXRhLnRoZW1lX3BhcmFtcykge1xuICAgICAgICAgICAgc2V0VGhlbWVQYXJhbXMoZXZlbnREYXRhLnRoZW1lX3BhcmFtcyk7XG4gICAgICAgICAgICB3aW5kb3cuVGVsZWdyYW0uV2ViQXBwLk1haW5CdXR0b24uc2V0UGFyYW1zKHt9KTtcbiAgICAgICAgICAgIHVwZGF0ZUJhY2tncm91bmRDb2xvcigpO1xuICAgICAgICAgICAgcmVjZWl2ZVdlYlZpZXdFdmVudCgndGhlbWVDaGFuZ2VkJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmFyIGxhc3RXaW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgZnVuY3Rpb24gb25WaWV3cG9ydENoYW5nZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgaWYgKGV2ZW50RGF0YS5oZWlnaHQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvbldpbmRvd1Jlc2l6ZSk7XG4gICAgICAgICAgICBzZXRWaWV3cG9ydEhlaWdodChldmVudERhdGEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uV2luZG93UmVzaXplKGUpIHtcbiAgICAgICAgaWYgKGxhc3RXaW5kb3dIZWlnaHQgIT0gd2luZG93LmlubmVySGVpZ2h0KSB7XG4gICAgICAgICAgICBsYXN0V2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICAgICAgcmVjZWl2ZVdlYlZpZXdFdmVudCgndmlld3BvcnRDaGFuZ2VkJywge1xuICAgICAgICAgICAgICAgIGlzU3RhdGVTdGFibGU6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGxpbmtIYW5kbGVyKGUpIHtcbiAgICAgICAgaWYgKGUubWV0YUtleSB8fCBlLmN0cmxLZXkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHZhciBlbCA9IGUudGFyZ2V0O1xuICAgICAgICB3aGlsZSAoZWwudGFnTmFtZSAhPSAnQScgJiYgZWwucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgZWwgPSBlbC5wYXJlbnROb2RlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbC50YWdOYW1lID09ICdBJyAmJlxuICAgICAgICAgICAgZWwudGFyZ2V0ICE9ICdfYmxhbmsnICYmXG4gICAgICAgICAgICAoZWwucHJvdG9jb2wgPT0gJ2h0dHA6JyB8fCBlbC5wcm90b2NvbCA9PSAnaHR0cHM6JykgJiZcbiAgICAgICAgICAgIGVsLmhvc3RuYW1lID09ICd0Lm1lJykge1xuICAgICAgICAgICAgV2ViQXBwLm9wZW5UZ0xpbmsoZWwuaHJlZik7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gc3RyVHJpbShzdHIpIHtcbiAgICAgICAgcmV0dXJuIHN0ci50b1N0cmluZygpLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcmVjZWl2ZVdlYlZpZXdFdmVudChldmVudFR5cGUpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICAgICAgICBldmVudFR5cGUgPSBhcmdzLnNoaWZ0KCk7XG4gICAgICAgIFdlYlZpZXcuY2FsbEV2ZW50Q2FsbGJhY2tzKCd3ZWJ2aWV3OicgKyBldmVudFR5cGUsIGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2suYXBwbHkoV2ViQXBwLCBhcmdzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uV2ViVmlld0V2ZW50KGV2ZW50VHlwZSwgY2FsbGJhY2spIHtcbiAgICAgICAgV2ViVmlldy5vbkV2ZW50KCd3ZWJ2aWV3OicgKyBldmVudFR5cGUsIGNhbGxiYWNrKTtcbiAgICB9XG4gICAgO1xuICAgIGZ1bmN0aW9uIG9mZldlYlZpZXdFdmVudChldmVudFR5cGUsIGNhbGxiYWNrKSB7XG4gICAgICAgIFdlYlZpZXcub2ZmRXZlbnQoJ3dlYnZpZXc6JyArIGV2ZW50VHlwZSwgY2FsbGJhY2spO1xuICAgIH1cbiAgICA7XG4gICAgZnVuY3Rpb24gc2V0Q3NzUHJvcGVydHkobmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdmFyIHJvb3QgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICAgIGlmIChyb290ICYmIHJvb3Quc3R5bGUgJiYgcm9vdC5zdHlsZS5zZXRQcm9wZXJ0eSkge1xuICAgICAgICAgICAgcm9vdC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS10Zy0nICsgbmFtZSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNldFRoZW1lUGFyYW1zKHRoZW1lX3BhcmFtcykge1xuICAgICAgICAvLyB0ZW1wIGlPUyBmaXhcbiAgICAgICAgaWYgKHRoZW1lX3BhcmFtcy5iZ19jb2xvciA9PSAnIzFjMWMxZCcgJiZcbiAgICAgICAgICAgIHRoZW1lX3BhcmFtcy5iZ19jb2xvciA9PSB0aGVtZV9wYXJhbXMuc2Vjb25kYXJ5X2JnX2NvbG9yKSB7XG4gICAgICAgICAgICB0aGVtZV9wYXJhbXMuc2Vjb25kYXJ5X2JnX2NvbG9yID0gJyMyYzJjMmUnO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb2xvcjtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoZW1lX3BhcmFtcykge1xuICAgICAgICAgICAgaWYgKGNvbG9yID0gcGFyc2VDb2xvclRvSGV4KHRoZW1lX3BhcmFtc1trZXldKSkge1xuICAgICAgICAgICAgICAgIHRoZW1lUGFyYW1zW2tleV0gPSBjb2xvcjtcbiAgICAgICAgICAgICAgICBpZiAoa2V5ID09ICdiZ19jb2xvcicpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sb3JTY2hlbWUgPSBpc0NvbG9yRGFyayhjb2xvcikgPyAnZGFyaycgOiAnbGlnaHQnO1xuICAgICAgICAgICAgICAgICAgICBzZXRDc3NQcm9wZXJ0eSgnY29sb3Itc2NoZW1lJywgY29sb3JTY2hlbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBrZXkgPSAndGhlbWUtJyArIGtleS5zcGxpdCgnXycpLmpvaW4oJy0nKTtcbiAgICAgICAgICAgICAgICBzZXRDc3NQcm9wZXJ0eShrZXksIGNvbG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBVdGlscy5zZXNzaW9uU3RvcmFnZVNldCgndGhlbWVQYXJhbXMnLCB0aGVtZVBhcmFtcyk7XG4gICAgfVxuICAgIHZhciB3ZWJBcHBDYWxsYmFja3MgPSB7fTtcbiAgICBmdW5jdGlvbiBnZW5lcmF0ZUNhbGxiYWNrSWQobGVuKSB7XG4gICAgICAgIHZhciB0cmllcyA9IDEwMDtcbiAgICAgICAgd2hpbGUgKC0tdHJpZXMpIHtcbiAgICAgICAgICAgIHZhciBpZCA9ICcnLCBjaGFycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OScsIGNoYXJzX2xlbiA9IGNoYXJzLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZCArPSBjaGFyc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjaGFyc19sZW4pXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghd2ViQXBwQ2FsbGJhY2tzW2lkXSkge1xuICAgICAgICAgICAgICAgIHdlYkFwcENhbGxiYWNrc1tpZF0gPSB7fTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcENhbGxiYWNrSWRHZW5lcmF0ZUZhaWxlZCcpO1xuICAgIH1cbiAgICB2YXIgdmlld3BvcnRIZWlnaHQgPSBmYWxzZSwgdmlld3BvcnRTdGFibGVIZWlnaHQgPSBmYWxzZSwgaXNFeHBhbmRlZCA9IHRydWU7XG4gICAgZnVuY3Rpb24gc2V0Vmlld3BvcnRIZWlnaHQoZGF0YSkge1xuICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBpc0V4cGFuZGVkID0gISFkYXRhLmlzX2V4cGFuZGVkO1xuICAgICAgICAgICAgdmlld3BvcnRIZWlnaHQgPSBkYXRhLmhlaWdodDtcbiAgICAgICAgICAgIGlmIChkYXRhLmlzX3N0YXRlX3N0YWJsZSkge1xuICAgICAgICAgICAgICAgIHZpZXdwb3J0U3RhYmxlSGVpZ2h0ID0gZGF0YS5oZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZWNlaXZlV2ViVmlld0V2ZW50KCd2aWV3cG9ydENoYW5nZWQnLCB7XG4gICAgICAgICAgICAgICAgaXNTdGF0ZVN0YWJsZTogISFkYXRhLmlzX3N0YXRlX3N0YWJsZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhlaWdodCwgc3RhYmxlX2hlaWdodDtcbiAgICAgICAgaWYgKHZpZXdwb3J0SGVpZ2h0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgaGVpZ2h0ID0gKHZpZXdwb3J0SGVpZ2h0IC0gbWFpbkJ1dHRvbkhlaWdodCkgKyAncHgnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGVpZ2h0ID0gbWFpbkJ1dHRvbkhlaWdodCA/ICdjYWxjKDEwMHZoIC0gJyArIG1haW5CdXR0b25IZWlnaHQgKyAncHgpJyA6ICcxMDB2aCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZpZXdwb3J0U3RhYmxlSGVpZ2h0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgc3RhYmxlX2hlaWdodCA9ICh2aWV3cG9ydFN0YWJsZUhlaWdodCAtIG1haW5CdXR0b25IZWlnaHQpICsgJ3B4JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YWJsZV9oZWlnaHQgPSBtYWluQnV0dG9uSGVpZ2h0ID8gJ2NhbGMoMTAwdmggLSAnICsgbWFpbkJ1dHRvbkhlaWdodCArICdweCknIDogJzEwMHZoJztcbiAgICAgICAgfVxuICAgICAgICBzZXRDc3NQcm9wZXJ0eSgndmlld3BvcnQtaGVpZ2h0JywgaGVpZ2h0KTtcbiAgICAgICAgc2V0Q3NzUHJvcGVydHkoJ3ZpZXdwb3J0LXN0YWJsZS1oZWlnaHQnLCBzdGFibGVfaGVpZ2h0KTtcbiAgICB9XG4gICAgdmFyIGlzQ2xvc2luZ0NvbmZpcm1hdGlvbkVuYWJsZWQgPSBmYWxzZTtcbiAgICBmdW5jdGlvbiBzZXRDbG9zaW5nQ29uZmlybWF0aW9uKG5lZWRfY29uZmlybWF0aW9uKSB7XG4gICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuMicpKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1tUZWxlZ3JhbS5XZWJBcHBdIENsb3NpbmcgY29uZmlybWF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaXNDbG9zaW5nQ29uZmlybWF0aW9uRW5hYmxlZCA9ICEhbmVlZF9jb25maXJtYXRpb247XG4gICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX3NldHVwX2Nsb3NpbmdfYmVoYXZpb3InLCBmYWxzZSwgeyBuZWVkX2NvbmZpcm1hdGlvbjogaXNDbG9zaW5nQ29uZmlybWF0aW9uRW5hYmxlZCB9KTtcbiAgICB9XG4gICAgdmFyIGhlYWRlckNvbG9yS2V5ID0gJ2JnX2NvbG9yJywgaGVhZGVyQ29sb3IgPSBudWxsO1xuICAgIGZ1bmN0aW9uIGdldEhlYWRlckNvbG9yKCkge1xuICAgICAgICBpZiAoaGVhZGVyQ29sb3JLZXkgPT0gJ3NlY29uZGFyeV9iZ19jb2xvcicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGVtZVBhcmFtcy5zZWNvbmRhcnlfYmdfY29sb3I7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaGVhZGVyQ29sb3JLZXkgPT0gJ2JnX2NvbG9yJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoZW1lUGFyYW1zLmJnX2NvbG9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoZWFkZXJDb2xvcjtcbiAgICB9XG4gICAgZnVuY3Rpb24gc2V0SGVhZGVyQ29sb3IoY29sb3IpIHtcbiAgICAgICAgaWYgKCF2ZXJzaW9uQXRMZWFzdCgnNi4xJykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignW1RlbGVncmFtLldlYkFwcF0gSGVhZGVyIGNvbG9yIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF2ZXJzaW9uQXRMZWFzdCgnNi45JykpIHtcbiAgICAgICAgICAgIGlmICh0aGVtZVBhcmFtcy5iZ19jb2xvciAmJlxuICAgICAgICAgICAgICAgIHRoZW1lUGFyYW1zLmJnX2NvbG9yID09IGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSAnYmdfY29sb3InO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhlbWVQYXJhbXMuc2Vjb25kYXJ5X2JnX2NvbG9yICYmXG4gICAgICAgICAgICAgICAgdGhlbWVQYXJhbXMuc2Vjb25kYXJ5X2JnX2NvbG9yID09IGNvbG9yKSB7XG4gICAgICAgICAgICAgICAgY29sb3IgPSAnc2Vjb25kYXJ5X2JnX2NvbG9yJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgaGVhZF9jb2xvciA9IG51bGwsIGNvbG9yX2tleSA9IG51bGw7XG4gICAgICAgIGlmIChjb2xvciA9PSAnYmdfY29sb3InIHx8IGNvbG9yID09ICdzZWNvbmRhcnlfYmdfY29sb3InKSB7XG4gICAgICAgICAgICBjb2xvcl9rZXkgPSBjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2ZXJzaW9uQXRMZWFzdCgnNi45JykpIHtcbiAgICAgICAgICAgIGhlYWRfY29sb3IgPSBwYXJzZUNvbG9yVG9IZXgoY29sb3IpO1xuICAgICAgICAgICAgaWYgKCFoZWFkX2NvbG9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gSGVhZGVyIGNvbG9yIGZvcm1hdCBpcyBpbnZhbGlkJywgY29sb3IpO1xuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBIZWFkZXJDb2xvckludmFsaWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXZlcnNpb25BdExlYXN0KCc2LjknKSAmJlxuICAgICAgICAgICAgY29sb3Jfa2V5ICE9ICdiZ19jb2xvcicgJiZcbiAgICAgICAgICAgIGNvbG9yX2tleSAhPSAnc2Vjb25kYXJ5X2JnX2NvbG9yJykge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gSGVhZGVyIGNvbG9yIGtleSBzaG91bGQgYmUgb25lIG9mIFRlbGVncmFtLldlYkFwcC50aGVtZVBhcmFtcy5iZ19jb2xvciwgVGVsZWdyYW0uV2ViQXBwLnRoZW1lUGFyYW1zLnNlY29uZGFyeV9iZ19jb2xvciwgXFwnYmdfY29sb3JcXCcsIFxcJ3NlY29uZGFyeV9iZ19jb2xvclxcJycsIGNvbG9yKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBIZWFkZXJDb2xvcktleUludmFsaWQnKTtcbiAgICAgICAgfVxuICAgICAgICBoZWFkZXJDb2xvcktleSA9IGNvbG9yX2tleTtcbiAgICAgICAgaGVhZGVyQ29sb3IgPSBoZWFkX2NvbG9yO1xuICAgICAgICB1cGRhdGVIZWFkZXJDb2xvcigpO1xuICAgIH1cbiAgICB2YXIgYXBwSGVhZGVyQ29sb3JLZXkgPSBudWxsLCBhcHBIZWFkZXJDb2xvciA9IG51bGw7XG4gICAgZnVuY3Rpb24gdXBkYXRlSGVhZGVyQ29sb3IoKSB7XG4gICAgICAgIGlmIChhcHBIZWFkZXJDb2xvcktleSAhPSBoZWFkZXJDb2xvcktleSB8fFxuICAgICAgICAgICAgYXBwSGVhZGVyQ29sb3IgIT0gaGVhZGVyQ29sb3IpIHtcbiAgICAgICAgICAgIGFwcEhlYWRlckNvbG9yS2V5ID0gaGVhZGVyQ29sb3JLZXk7XG4gICAgICAgICAgICBhcHBIZWFkZXJDb2xvciA9IGhlYWRlckNvbG9yO1xuICAgICAgICAgICAgaWYgKGFwcEhlYWRlckNvbG9yKSB7XG4gICAgICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfc2V0X2hlYWRlcl9jb2xvcicsIGZhbHNlLCB7IGNvbG9yOiBoZWFkZXJDb2xvciB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX3NldF9oZWFkZXJfY29sb3InLCBmYWxzZSwgeyBjb2xvcl9rZXk6IGhlYWRlckNvbG9yS2V5IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBiYWNrZ3JvdW5kQ29sb3IgPSAnYmdfY29sb3InO1xuICAgIGZ1bmN0aW9uIGdldEJhY2tncm91bmRDb2xvcigpIHtcbiAgICAgICAgaWYgKGJhY2tncm91bmRDb2xvciA9PSAnc2Vjb25kYXJ5X2JnX2NvbG9yJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoZW1lUGFyYW1zLnNlY29uZGFyeV9iZ19jb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChiYWNrZ3JvdW5kQ29sb3IgPT0gJ2JnX2NvbG9yJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoZW1lUGFyYW1zLmJnX2NvbG9yO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBiYWNrZ3JvdW5kQ29sb3I7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHNldEJhY2tncm91bmRDb2xvcihjb2xvcikge1xuICAgICAgICBpZiAoIXZlcnNpb25BdExlYXN0KCc2LjEnKSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdbVGVsZWdyYW0uV2ViQXBwXSBCYWNrZ3JvdW5kIGNvbG9yIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGJnX2NvbG9yO1xuICAgICAgICBpZiAoY29sb3IgPT0gJ2JnX2NvbG9yJyB8fCBjb2xvciA9PSAnc2Vjb25kYXJ5X2JnX2NvbG9yJykge1xuICAgICAgICAgICAgYmdfY29sb3IgPSBjb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJnX2NvbG9yID0gcGFyc2VDb2xvclRvSGV4KGNvbG9yKTtcbiAgICAgICAgICAgIGlmICghYmdfY29sb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBCYWNrZ3JvdW5kIGNvbG9yIGZvcm1hdCBpcyBpbnZhbGlkJywgY29sb3IpO1xuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBCYWNrZ3JvdW5kQ29sb3JJbnZhbGlkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYmFja2dyb3VuZENvbG9yID0gYmdfY29sb3I7XG4gICAgICAgIHVwZGF0ZUJhY2tncm91bmRDb2xvcigpO1xuICAgIH1cbiAgICB2YXIgYXBwQmFja2dyb3VuZENvbG9yID0gbnVsbDtcbiAgICBmdW5jdGlvbiB1cGRhdGVCYWNrZ3JvdW5kQ29sb3IoKSB7XG4gICAgICAgIHZhciBjb2xvciA9IGdldEJhY2tncm91bmRDb2xvcigpO1xuICAgICAgICBpZiAoYXBwQmFja2dyb3VuZENvbG9yICE9IGNvbG9yKSB7XG4gICAgICAgICAgICBhcHBCYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcbiAgICAgICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX3NldF9iYWNrZ3JvdW5kX2NvbG9yJywgZmFsc2UsIHsgY29sb3I6IGNvbG9yIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIHBhcnNlQ29sb3JUb0hleChjb2xvcikge1xuICAgICAgICBjb2xvciArPSAnJztcbiAgICAgICAgdmFyIG1hdGNoO1xuICAgICAgICBpZiAobWF0Y2ggPSAvXlxccyojKFswLTlhLWZdezZ9KVxccyokL2kuZXhlYyhjb2xvcikpIHtcbiAgICAgICAgICAgIHJldHVybiAnIycgKyBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1hdGNoID0gL15cXHMqIyhbMC05YS1mXSkoWzAtOWEtZl0pKFswLTlhLWZdKVxccyokL2kuZXhlYyhjb2xvcikpIHtcbiAgICAgICAgICAgIHJldHVybiAoJyMnICsgbWF0Y2hbMV0gKyBtYXRjaFsxXSArIG1hdGNoWzJdICsgbWF0Y2hbMl0gKyBtYXRjaFszXSArIG1hdGNoWzNdKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1hdGNoID0gL15cXHMqcmdiYT9cXCgoXFxkKyksXFxzKihcXGQrKSxcXHMqKFxcZCspKD86LFxccyooXFxkK1xcLnswLDF9XFxkKikpP1xcKVxccyokLy5leGVjKGNvbG9yKSkge1xuICAgICAgICAgICAgdmFyIHIgPSBwYXJzZUludChtYXRjaFsxXSksIGcgPSBwYXJzZUludChtYXRjaFsyXSksIGIgPSBwYXJzZUludChtYXRjaFszXSk7XG4gICAgICAgICAgICByID0gKHIgPCAxNiA/ICcwJyA6ICcnKSArIHIudG9TdHJpbmcoMTYpO1xuICAgICAgICAgICAgZyA9IChnIDwgMTYgPyAnMCcgOiAnJykgKyBnLnRvU3RyaW5nKDE2KTtcbiAgICAgICAgICAgIGIgPSAoYiA8IDE2ID8gJzAnIDogJycpICsgYi50b1N0cmluZygxNik7XG4gICAgICAgICAgICByZXR1cm4gJyMnICsgciArIGcgKyBiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaXNDb2xvckRhcmsocmdiKSB7XG4gICAgICAgIHJnYiA9IHJnYi5yZXBsYWNlKC9bXFxzI10vZywgJycpO1xuICAgICAgICBpZiAocmdiLmxlbmd0aCA9PSAzKSB7XG4gICAgICAgICAgICByZ2IgPSByZ2JbMF0gKyByZ2JbMF0gKyByZ2JbMV0gKyByZ2JbMV0gKyByZ2JbMl0gKyByZ2JbMl07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHIgPSBwYXJzZUludChyZ2Iuc3Vic3RyKDAsIDIpLCAxNik7XG4gICAgICAgIHZhciBnID0gcGFyc2VJbnQocmdiLnN1YnN0cigyLCAyKSwgMTYpO1xuICAgICAgICB2YXIgYiA9IHBhcnNlSW50KHJnYi5zdWJzdHIoNCwgMiksIDE2KTtcbiAgICAgICAgdmFyIGhzcCA9IE1hdGguc3FydCgwLjI5OSAqIChyICogcikgKyAwLjU4NyAqIChnICogZykgKyAwLjExNCAqIChiICogYikpO1xuICAgICAgICByZXR1cm4gaHNwIDwgMTIwO1xuICAgIH1cbiAgICBmdW5jdGlvbiB2ZXJzaW9uQ29tcGFyZSh2MSwgdjIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2MSAhPT0gJ3N0cmluZycpXG4gICAgICAgICAgICB2MSA9ICcnO1xuICAgICAgICBpZiAodHlwZW9mIHYyICE9PSAnc3RyaW5nJylcbiAgICAgICAgICAgIHYyID0gJyc7XG4gICAgICAgIHYxID0gdjEucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpLnNwbGl0KCcuJyk7XG4gICAgICAgIHYyID0gdjIucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpLnNwbGl0KCcuJyk7XG4gICAgICAgIHZhciBhID0gTWF0aC5tYXgodjEubGVuZ3RoLCB2Mi5sZW5ndGgpLCBpLCBwMSwgcDI7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBhOyBpKyspIHtcbiAgICAgICAgICAgIHAxID0gcGFyc2VJbnQodjFbaV0pIHx8IDA7XG4gICAgICAgICAgICBwMiA9IHBhcnNlSW50KHYyW2ldKSB8fCAwO1xuICAgICAgICAgICAgaWYgKHAxID09IHAyKVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgaWYgKHAxID4gcDIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHZlcnNpb25BdExlYXN0KHZlcikge1xuICAgICAgICByZXR1cm4gdmVyc2lvbkNvbXBhcmUod2ViQXBwVmVyc2lvbiwgdmVyKSA+PSAwO1xuICAgIH1cbiAgICBmdW5jdGlvbiBieXRlTGVuZ3RoKHN0cikge1xuICAgICAgICBpZiAod2luZG93LkJsb2IpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFtzdHJdKS5zaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBzID0gc3RyLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IHN0ci5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdmFyIGNvZGUgPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgIGlmIChjb2RlID4gMHg3ZiAmJiBjb2RlIDw9IDB4N2ZmKVxuICAgICAgICAgICAgICAgIHMrKztcbiAgICAgICAgICAgIGVsc2UgaWYgKGNvZGUgPiAweDdmZiAmJiBjb2RlIDw9IDB4ZmZmZilcbiAgICAgICAgICAgICAgICBzICs9IDI7XG4gICAgICAgICAgICBpZiAoY29kZSA+PSAweGRjMDAgJiYgY29kZSA8PSAweGRmZmYpXG4gICAgICAgICAgICAgICAgaS0tO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzO1xuICAgIH1cbiAgICB2YXIgQmFja0J1dHRvbiA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpc1Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGJhY2tCdXR0b24gPSB7fTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGJhY2tCdXR0b24sICdpc1Zpc2libGUnLCB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsgc2V0UGFyYW1zKHsgaXNfdmlzaWJsZTogdmFsIH0pOyB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBpc1Zpc2libGU7IH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgY3VyQnV0dG9uU3RhdGUgPSBudWxsO1xuICAgICAgICBXZWJWaWV3Lm9uRXZlbnQoJ2JhY2tfYnV0dG9uX3ByZXNzZWQnLCBvbkJhY2tCdXR0b25QcmVzc2VkKTtcbiAgICAgICAgZnVuY3Rpb24gb25CYWNrQnV0dG9uUHJlc3NlZCgpIHtcbiAgICAgICAgICAgIHJlY2VpdmVXZWJWaWV3RXZlbnQoJ2JhY2tCdXR0b25DbGlja2VkJyk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYnV0dG9uUGFyYW1zKCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgaXNfdmlzaWJsZTogaXNWaXNpYmxlIH07XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYnV0dG9uU3RhdGUoYnRuX3BhcmFtcykge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBidG5fcGFyYW1zID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGJ0bl9wYXJhbXMgPSBidXR0b25QYXJhbXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShidG5fcGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBidXR0b25DaGVja1ZlcnNpb24oKSB7XG4gICAgICAgICAgICBpZiAoIXZlcnNpb25BdExlYXN0KCc2LjEnKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignW1RlbGVncmFtLldlYkFwcF0gQmFja0J1dHRvbiBpcyBub3Qgc3VwcG9ydGVkIGluIHZlcnNpb24gJyArIHdlYkFwcFZlcnNpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUJ1dHRvbigpIHtcbiAgICAgICAgICAgIHZhciBidG5fcGFyYW1zID0gYnV0dG9uUGFyYW1zKCk7XG4gICAgICAgICAgICB2YXIgYnRuX3N0YXRlID0gYnV0dG9uU3RhdGUoYnRuX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoY3VyQnV0dG9uU3RhdGUgPT09IGJ0bl9zdGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1ckJ1dHRvblN0YXRlID0gYnRuX3N0YXRlO1xuICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfc2V0dXBfYmFja19idXR0b24nLCBmYWxzZSwgYnRuX3BhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gc2V0UGFyYW1zKHBhcmFtcykge1xuICAgICAgICAgICAgaWYgKCFidXR0b25DaGVja1ZlcnNpb24oKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBiYWNrQnV0dG9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuaXNfdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpc1Zpc2libGUgPSAhIXBhcmFtcy5pc192aXNpYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBkYXRlQnV0dG9uKCk7XG4gICAgICAgICAgICByZXR1cm4gYmFja0J1dHRvbjtcbiAgICAgICAgfVxuICAgICAgICBiYWNrQnV0dG9uLm9uQ2xpY2sgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmIChidXR0b25DaGVja1ZlcnNpb24oKSkge1xuICAgICAgICAgICAgICAgIG9uV2ViVmlld0V2ZW50KCdiYWNrQnV0dG9uQ2xpY2tlZCcsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBiYWNrQnV0dG9uO1xuICAgICAgICB9O1xuICAgICAgICBiYWNrQnV0dG9uLm9mZkNsaWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZiAoYnV0dG9uQ2hlY2tWZXJzaW9uKCkpIHtcbiAgICAgICAgICAgICAgICBvZmZXZWJWaWV3RXZlbnQoJ2JhY2tCdXR0b25DbGlja2VkJywgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGJhY2tCdXR0b247XG4gICAgICAgIH07XG4gICAgICAgIGJhY2tCdXR0b24uc2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXRQYXJhbXMoeyBpc192aXNpYmxlOiB0cnVlIH0pO1xuICAgICAgICB9O1xuICAgICAgICBiYWNrQnV0dG9uLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0UGFyYW1zKHsgaXNfdmlzaWJsZTogZmFsc2UgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBiYWNrQnV0dG9uO1xuICAgIH0pKCk7XG4gICAgdmFyIG1haW5CdXR0b25IZWlnaHQgPSAwO1xuICAgIHZhciBNYWluQnV0dG9uID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGlzVmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB2YXIgaXNBY3RpdmUgPSB0cnVlO1xuICAgICAgICB2YXIgaXNQcm9ncmVzc1Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdmFyIGJ1dHRvblRleHQgPSAnQ09OVElOVUUnO1xuICAgICAgICB2YXIgYnV0dG9uQ29sb3IgPSBmYWxzZTtcbiAgICAgICAgdmFyIGJ1dHRvblRleHRDb2xvciA9IGZhbHNlO1xuICAgICAgICB2YXIgbWFpbkJ1dHRvbiA9IHt9O1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobWFpbkJ1dHRvbiwgJ3RleHQnLCB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsgbWFpbkJ1dHRvbi5zZXRQYXJhbXMoeyB0ZXh0OiB2YWwgfSk7IH0sXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJ1dHRvblRleHQ7IH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobWFpbkJ1dHRvbiwgJ2NvbG9yJywge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7IG1haW5CdXR0b24uc2V0UGFyYW1zKHsgY29sb3I6IHZhbCB9KTsgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gYnV0dG9uQ29sb3IgfHwgdGhlbWVQYXJhbXMuYnV0dG9uX2NvbG9yIHx8ICcjMjQ4MWNjJzsgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtYWluQnV0dG9uLCAndGV4dENvbG9yJywge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7IG1haW5CdXR0b24uc2V0UGFyYW1zKHsgdGV4dF9jb2xvcjogdmFsIH0pOyB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBidXR0b25UZXh0Q29sb3IgfHwgdGhlbWVQYXJhbXMuYnV0dG9uX3RleHRfY29sb3IgfHwgJyNmZmZmZmYnOyB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1haW5CdXR0b24sICdpc1Zpc2libGUnLCB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsgbWFpbkJ1dHRvbi5zZXRQYXJhbXMoeyBpc192aXNpYmxlOiB2YWwgfSk7IH0sXG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGlzVmlzaWJsZTsgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtYWluQnV0dG9uLCAnaXNQcm9ncmVzc1Zpc2libGUnLCB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGlzUHJvZ3Jlc3NWaXNpYmxlOyB9LFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1haW5CdXR0b24sICdpc0FjdGl2ZScsIHtcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkgeyBtYWluQnV0dG9uLnNldFBhcmFtcyh7IGlzX2FjdGl2ZTogdmFsIH0pOyB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBpc0FjdGl2ZTsgfSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBjdXJCdXR0b25TdGF0ZSA9IG51bGw7XG4gICAgICAgIFdlYlZpZXcub25FdmVudCgnbWFpbl9idXR0b25fcHJlc3NlZCcsIG9uTWFpbkJ1dHRvblByZXNzZWQpO1xuICAgICAgICB2YXIgZGVidWdCdG4gPSBudWxsLCBkZWJ1Z0J0blN0eWxlID0ge307XG4gICAgICAgIGlmIChpbml0UGFyYW1zLnRnV2ViQXBwRGVidWcpIHtcbiAgICAgICAgICAgIGRlYnVnQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGctbWFpbi1idXR0b24nKTtcbiAgICAgICAgICAgIGRlYnVnQnRuU3R5bGUgPSB7XG4gICAgICAgICAgICAgICAgZm9udDogJzYwMCAxNHB4LzE4cHggc2Fucy1zZXJpZicsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogJ25vbmUnLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAnNDhweCcsXG4gICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnMCcsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJ25vLXJlcGVhdCByaWdodCBjZW50ZXInLFxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgIGxlZnQ6ICcwJyxcbiAgICAgICAgICAgICAgICByaWdodDogJzAnLFxuICAgICAgICAgICAgICAgIGJvdHRvbTogJzAnLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogJzAnLFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6ICcxNXB4IDIwcHgnLFxuICAgICAgICAgICAgICAgIHRleHRBbGlnbjogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgYm94U2l6aW5nOiAnYm9yZGVyLWJveCcsXG4gICAgICAgICAgICAgICAgekluZGV4OiAnMTAwMDAnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBkZWJ1Z0J0blN0eWxlKSB7XG4gICAgICAgICAgICAgICAgZGVidWdCdG4uc3R5bGVba10gPSBkZWJ1Z0J0blN0eWxlW2tdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uIG9uRG9tTG9hZGVkKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIG9uRG9tTG9hZGVkKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGRlYnVnQnRuKTtcbiAgICAgICAgICAgICAgICBkZWJ1Z0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTWFpbkJ1dHRvblByZXNzZWQsIGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIG9uTWFpbkJ1dHRvblByZXNzZWQoKSB7XG4gICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZWNlaXZlV2ViVmlld0V2ZW50KCdtYWluQnV0dG9uQ2xpY2tlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGJ1dHRvblBhcmFtcygpIHtcbiAgICAgICAgICAgIHZhciBjb2xvciA9IG1haW5CdXR0b24uY29sb3I7XG4gICAgICAgICAgICB2YXIgdGV4dF9jb2xvciA9IG1haW5CdXR0b24udGV4dENvbG9yO1xuICAgICAgICAgICAgcmV0dXJuIGlzVmlzaWJsZSA/IHtcbiAgICAgICAgICAgICAgICBpc192aXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzX2FjdGl2ZTogaXNBY3RpdmUsXG4gICAgICAgICAgICAgICAgaXNfcHJvZ3Jlc3NfdmlzaWJsZTogaXNQcm9ncmVzc1Zpc2libGUsXG4gICAgICAgICAgICAgICAgdGV4dDogYnV0dG9uVGV4dCxcbiAgICAgICAgICAgICAgICBjb2xvcjogY29sb3IsXG4gICAgICAgICAgICAgICAgdGV4dF9jb2xvcjogdGV4dF9jb2xvclxuICAgICAgICAgICAgfSA6IHsgaXNfdmlzaWJsZTogZmFsc2UgfTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBidXR0b25TdGF0ZShidG5fcGFyYW1zKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGJ0bl9wYXJhbXMgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgYnRuX3BhcmFtcyA9IGJ1dHRvblBhcmFtcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGJ0bl9wYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUJ1dHRvbigpIHtcbiAgICAgICAgICAgIHZhciBidG5fcGFyYW1zID0gYnV0dG9uUGFyYW1zKCk7XG4gICAgICAgICAgICB2YXIgYnRuX3N0YXRlID0gYnV0dG9uU3RhdGUoYnRuX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoY3VyQnV0dG9uU3RhdGUgPT09IGJ0bl9zdGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1ckJ1dHRvblN0YXRlID0gYnRuX3N0YXRlO1xuICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfc2V0dXBfbWFpbl9idXR0b24nLCBmYWxzZSwgYnRuX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoaW5pdFBhcmFtcy50Z1dlYkFwcERlYnVnKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlRGVidWdCdXR0b24oYnRuX3BhcmFtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlRGVidWdCdXR0b24oYnRuX3BhcmFtcykge1xuICAgICAgICAgICAgaWYgKGJ0bl9wYXJhbXMuaXNfdmlzaWJsZSkge1xuICAgICAgICAgICAgICAgIGRlYnVnQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgICAgIG1haW5CdXR0b25IZWlnaHQgPSA0ODtcbiAgICAgICAgICAgICAgICBkZWJ1Z0J0bi5zdHlsZS5vcGFjaXR5ID0gYnRuX3BhcmFtcy5pc19hY3RpdmUgPyAnMScgOiAnMC44JztcbiAgICAgICAgICAgICAgICBkZWJ1Z0J0bi5zdHlsZS5jdXJzb3IgPSBidG5fcGFyYW1zLmlzX2FjdGl2ZSA/ICdwb2ludGVyJyA6ICdhdXRvJztcbiAgICAgICAgICAgICAgICBkZWJ1Z0J0bi5kaXNhYmxlZCA9ICFidG5fcGFyYW1zLmlzX2FjdGl2ZTtcbiAgICAgICAgICAgICAgICBkZWJ1Z0J0bi5pbm5lclRleHQgPSBidG5fcGFyYW1zLnRleHQ7XG4gICAgICAgICAgICAgICAgZGVidWdCdG4uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYnRuX3BhcmFtcy5pc19wcm9ncmVzc192aXNpYmxlID8gXCJ1cmwoJ2RhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmclMjB4bWxucyUzRCUyMmh0dHAlM0ElMkYlMkZ3d3cudzMub3JnJTJGMjAwMCUyRnN2ZyUyMiUyMHhtbG5zJTNBeGxpbmslM0QlMjJodHRwJTNBJTJGJTJGd3d3LnczLm9yZyUyRjE5OTklMkZ4bGluayUyMiUyMHZpZXdwb3J0JTNEJTIyMCUyMDAlMjA0OCUyMDQ4JTIyJTIwd2lkdGglM0QlMjI0OHB4JTIyJTIwaGVpZ2h0JTNEJTIyNDhweCUyMiUzRSUzQ2NpcmNsZSUyMGN4JTNEJTIyNTAlMjUlMjIlMjBjeSUzRCUyMjUwJTI1JTIyJTIwc3Ryb2tlJTNEJTIyJTIzZmZmJTIyJTIwc3Ryb2tlLXdpZHRoJTNEJTIyMi4yNSUyMiUyMHN0cm9rZS1saW5lY2FwJTNEJTIycm91bmQlMjIlMjBmaWxsJTNEJTIybm9uZSUyMiUyMHN0cm9rZS1kYXNob2Zmc2V0JTNEJTIyMTA2JTIyJTIwciUzRCUyMjklMjIlMjBzdHJva2UtZGFzaGFycmF5JTNEJTIyNTYuNTIlMjIlMjByb3RhdGUlM0QlMjItOTAlMjIlM0UlM0NhbmltYXRlJTIwYXR0cmlidXRlTmFtZSUzRCUyMnN0cm9rZS1kYXNob2Zmc2V0JTIyJTIwYXR0cmlidXRlVHlwZSUzRCUyMlhNTCUyMiUyMGR1ciUzRCUyMjM2MHMlMjIlMjBmcm9tJTNEJTIyMCUyMiUyMHRvJTNEJTIyMTI1MDAlMjIlMjByZXBlYXRDb3VudCUzRCUyMmluZGVmaW5pdGUlMjIlM0UlM0MlMkZhbmltYXRlJTNFJTNDYW5pbWF0ZVRyYW5zZm9ybSUyMGF0dHJpYnV0ZU5hbWUlM0QlMjJ0cmFuc2Zvcm0lMjIlMjBhdHRyaWJ1dGVUeXBlJTNEJTIyWE1MJTIyJTIwdHlwZSUzRCUyMnJvdGF0ZSUyMiUyMGR1ciUzRCUyMjFzJTIyJTIwZnJvbSUzRCUyMi05MCUyMDI0JTIwMjQlMjIlMjB0byUzRCUyMjYzMCUyMDI0JTIwMjQlMjIlMjByZXBlYXRDb3VudCUzRCUyMmluZGVmaW5pdGUlMjIlM0UlM0MlMkZhbmltYXRlVHJhbnNmb3JtJTNFJTNDJTJGY2lyY2xlJTNFJTNDJTJGc3ZnJTNFJylcIiA6ICdub25lJztcbiAgICAgICAgICAgICAgICBkZWJ1Z0J0bi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBidG5fcGFyYW1zLmNvbG9yO1xuICAgICAgICAgICAgICAgIGRlYnVnQnRuLnN0eWxlLmNvbG9yID0gYnRuX3BhcmFtcy50ZXh0X2NvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZGVidWdCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICBtYWluQnV0dG9uSGVpZ2h0ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuYm94U2l6aW5nID0gJ2JvcmRlci1ib3gnO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gbWFpbkJ1dHRvbkhlaWdodCArICdweCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRWaWV3cG9ydEhlaWdodCgpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNldFBhcmFtcyhwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyYW1zLnRleHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRleHQgPSBzdHJUcmltKHBhcmFtcy50ZXh0KTtcbiAgICAgICAgICAgICAgICBpZiAoIXRleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIE1haW4gYnV0dG9uIHRleHQgaXMgcmVxdWlyZWQnLCBwYXJhbXMudGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBNYWluQnV0dG9uUGFyYW1JbnZhbGlkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIE1haW4gYnV0dG9uIHRleHQgaXMgdG9vIGxvbmcnLCB0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcE1haW5CdXR0b25QYXJhbUludmFsaWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnV0dG9uVGV4dCA9IHRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcmFtcy5jb2xvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLmNvbG9yID09PSBmYWxzZSB8fFxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuY29sb3IgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ29sb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IHBhcnNlQ29sb3JUb0hleChwYXJhbXMuY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBNYWluIGJ1dHRvbiBjb2xvciBmb3JtYXQgaXMgaW52YWxpZCcsIHBhcmFtcy5jb2xvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwTWFpbkJ1dHRvblBhcmFtSW52YWxpZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNvbG9yID0gY29sb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMudGV4dF9jb2xvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLnRleHRfY29sb3IgPT09IGZhbHNlIHx8XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy50ZXh0X2NvbG9yID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvblRleHRDb2xvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRleHRfY29sb3IgPSBwYXJzZUNvbG9yVG9IZXgocGFyYW1zLnRleHRfY29sb3IpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXRleHRfY29sb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIE1haW4gYnV0dG9uIHRleHQgY29sb3IgZm9ybWF0IGlzIGludmFsaWQnLCBwYXJhbXMudGV4dF9jb2xvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwTWFpbkJ1dHRvblBhcmFtSW52YWxpZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvblRleHRDb2xvciA9IHRleHRfY29sb3I7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuaXNfdmlzaWJsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLmlzX3Zpc2libGUgJiZcbiAgICAgICAgICAgICAgICAgICAgIW1haW5CdXR0b24udGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gTWFpbiBidXR0b24gdGV4dCBpcyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwTWFpbkJ1dHRvblBhcmFtSW52YWxpZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpc1Zpc2libGUgPSAhIXBhcmFtcy5pc192aXNpYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuaXNfYWN0aXZlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGlzQWN0aXZlID0gISFwYXJhbXMuaXNfYWN0aXZlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXBkYXRlQnV0dG9uKCk7XG4gICAgICAgICAgICByZXR1cm4gbWFpbkJ1dHRvbjtcbiAgICAgICAgfVxuICAgICAgICBtYWluQnV0dG9uLnNldFRleHQgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIG1haW5CdXR0b24uc2V0UGFyYW1zKHsgdGV4dDogdGV4dCB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgbWFpbkJ1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBvbldlYlZpZXdFdmVudCgnbWFpbkJ1dHRvbkNsaWNrZWQnLCBjYWxsYmFjayk7XG4gICAgICAgICAgICByZXR1cm4gbWFpbkJ1dHRvbjtcbiAgICAgICAgfTtcbiAgICAgICAgbWFpbkJ1dHRvbi5vZmZDbGljayA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgb2ZmV2ViVmlld0V2ZW50KCdtYWluQnV0dG9uQ2xpY2tlZCcsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIHJldHVybiBtYWluQnV0dG9uO1xuICAgICAgICB9O1xuICAgICAgICBtYWluQnV0dG9uLnNob3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbWFpbkJ1dHRvbi5zZXRQYXJhbXMoeyBpc192aXNpYmxlOiB0cnVlIH0pO1xuICAgICAgICB9O1xuICAgICAgICBtYWluQnV0dG9uLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbWFpbkJ1dHRvbi5zZXRQYXJhbXMoeyBpc192aXNpYmxlOiBmYWxzZSB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgbWFpbkJ1dHRvbi5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbWFpbkJ1dHRvbi5zZXRQYXJhbXMoeyBpc19hY3RpdmU6IHRydWUgfSk7XG4gICAgICAgIH07XG4gICAgICAgIG1haW5CdXR0b24uZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBtYWluQnV0dG9uLnNldFBhcmFtcyh7IGlzX2FjdGl2ZTogZmFsc2UgfSk7XG4gICAgICAgIH07XG4gICAgICAgIG1haW5CdXR0b24uc2hvd1Byb2dyZXNzID0gZnVuY3Rpb24gKGxlYXZlQWN0aXZlKSB7XG4gICAgICAgICAgICBpc0FjdGl2ZSA9ICEhbGVhdmVBY3RpdmU7XG4gICAgICAgICAgICBpc1Byb2dyZXNzVmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB1cGRhdGVCdXR0b24oKTtcbiAgICAgICAgICAgIHJldHVybiBtYWluQnV0dG9uO1xuICAgICAgICB9O1xuICAgICAgICBtYWluQnV0dG9uLmhpZGVQcm9ncmVzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghbWFpbkJ1dHRvbi5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAgIGlzQWN0aXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlzUHJvZ3Jlc3NWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB1cGRhdGVCdXR0b24oKTtcbiAgICAgICAgICAgIHJldHVybiBtYWluQnV0dG9uO1xuICAgICAgICB9O1xuICAgICAgICBtYWluQnV0dG9uLnNldFBhcmFtcyA9IHNldFBhcmFtcztcbiAgICAgICAgcmV0dXJuIG1haW5CdXR0b247XG4gICAgfSkoKTtcbiAgICB2YXIgU2V0dGluZ3NCdXR0b24gPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaXNWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHZhciBzZXR0aW5nc0J1dHRvbiA9IHt9O1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc2V0dGluZ3NCdXR0b24sICdpc1Zpc2libGUnLCB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsgc2V0UGFyYW1zKHsgaXNfdmlzaWJsZTogdmFsIH0pOyB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBpc1Zpc2libGU7IH0sXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgY3VyQnV0dG9uU3RhdGUgPSBudWxsO1xuICAgICAgICBXZWJWaWV3Lm9uRXZlbnQoJ3NldHRpbmdzX2J1dHRvbl9wcmVzc2VkJywgb25TZXR0aW5nc0J1dHRvblByZXNzZWQpO1xuICAgICAgICBmdW5jdGlvbiBvblNldHRpbmdzQnV0dG9uUHJlc3NlZCgpIHtcbiAgICAgICAgICAgIHJlY2VpdmVXZWJWaWV3RXZlbnQoJ3NldHRpbmdzQnV0dG9uQ2xpY2tlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGJ1dHRvblBhcmFtcygpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGlzX3Zpc2libGU6IGlzVmlzaWJsZSB9O1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGJ1dHRvblN0YXRlKGJ0bl9wYXJhbXMpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYnRuX3BhcmFtcyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBidG5fcGFyYW1zID0gYnV0dG9uUGFyYW1zKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYnRuX3BhcmFtcyk7XG4gICAgICAgIH1cbiAgICAgICAgZnVuY3Rpb24gYnV0dG9uQ2hlY2tWZXJzaW9uKCkge1xuICAgICAgICAgICAgaWYgKCF2ZXJzaW9uQXRMZWFzdCgnNi4xMCcpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbVGVsZWdyYW0uV2ViQXBwXSBTZXR0aW5nc0J1dHRvbiBpcyBub3Qgc3VwcG9ydGVkIGluIHZlcnNpb24gJyArIHdlYkFwcFZlcnNpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUJ1dHRvbigpIHtcbiAgICAgICAgICAgIHZhciBidG5fcGFyYW1zID0gYnV0dG9uUGFyYW1zKCk7XG4gICAgICAgICAgICB2YXIgYnRuX3N0YXRlID0gYnV0dG9uU3RhdGUoYnRuX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoY3VyQnV0dG9uU3RhdGUgPT09IGJ0bl9zdGF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1ckJ1dHRvblN0YXRlID0gYnRuX3N0YXRlO1xuICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfc2V0dXBfc2V0dGluZ3NfYnV0dG9uJywgZmFsc2UsIGJ0bl9wYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNldFBhcmFtcyhwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmICghYnV0dG9uQ2hlY2tWZXJzaW9uKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NCdXR0b247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhcmFtcy5pc192aXNpYmxlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGlzVmlzaWJsZSA9ICEhcGFyYW1zLmlzX3Zpc2libGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1cGRhdGVCdXR0b24oKTtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nc0J1dHRvbjtcbiAgICAgICAgfVxuICAgICAgICBzZXR0aW5nc0J1dHRvbi5vbkNsaWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZiAoYnV0dG9uQ2hlY2tWZXJzaW9uKCkpIHtcbiAgICAgICAgICAgICAgICBvbldlYlZpZXdFdmVudCgnc2V0dGluZ3NCdXR0b25DbGlja2VkJywgY2FsbGJhY2spO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzQnV0dG9uO1xuICAgICAgICB9O1xuICAgICAgICBzZXR0aW5nc0J1dHRvbi5vZmZDbGljayA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYgKGJ1dHRvbkNoZWNrVmVyc2lvbigpKSB7XG4gICAgICAgICAgICAgICAgb2ZmV2ViVmlld0V2ZW50KCdzZXR0aW5nc0J1dHRvbkNsaWNrZWQnLCBjYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NCdXR0b247XG4gICAgICAgIH07XG4gICAgICAgIHNldHRpbmdzQnV0dG9uLnNob3cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0UGFyYW1zKHsgaXNfdmlzaWJsZTogdHJ1ZSB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgc2V0dGluZ3NCdXR0b24uaGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXRQYXJhbXMoeyBpc192aXNpYmxlOiBmYWxzZSB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzQnV0dG9uO1xuICAgIH0pKCk7XG4gICAgdmFyIEhhcHRpY0ZlZWRiYWNrID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhhcHRpY0ZlZWRiYWNrID0ge307XG4gICAgICAgIGZ1bmN0aW9uIHRyaWdnZXJGZWVkYmFjayhwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuMScpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdbVGVsZWdyYW0uV2ViQXBwXSBIYXB0aWNGZWVkYmFjayBpcyBub3Qgc3VwcG9ydGVkIGluIHZlcnNpb24gJyArIHdlYkFwcFZlcnNpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybiBoYXB0aWNGZWVkYmFjaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXJhbXMudHlwZSA9PSAnaW1wYWN0Jykge1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXMuaW1wYWN0X3N0eWxlICE9ICdsaWdodCcgJiZcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmltcGFjdF9zdHlsZSAhPSAnbWVkaXVtJyAmJlxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMuaW1wYWN0X3N0eWxlICE9ICdoZWF2eScgJiZcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmltcGFjdF9zdHlsZSAhPSAncmlnaWQnICYmXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5pbXBhY3Rfc3R5bGUgIT0gJ3NvZnQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIEhhcHRpYyBpbXBhY3Qgc3R5bGUgaXMgaW52YWxpZCcsIHBhcmFtcy5pbXBhY3Rfc3R5bGUpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwSGFwdGljSW1wYWN0U3R5bGVJbnZhbGlkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1zLnR5cGUgPT0gJ25vdGlmaWNhdGlvbicpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLm5vdGlmaWNhdGlvbl90eXBlICE9ICdlcnJvcicgJiZcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLm5vdGlmaWNhdGlvbl90eXBlICE9ICdzdWNjZXNzJyAmJlxuICAgICAgICAgICAgICAgICAgICBwYXJhbXMubm90aWZpY2F0aW9uX3R5cGUgIT0gJ3dhcm5pbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIEhhcHRpYyBub3RpZmljYXRpb24gdHlwZSBpcyBpbnZhbGlkJywgcGFyYW1zLm5vdGlmaWNhdGlvbl90eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcEhhcHRpY05vdGlmaWNhdGlvblR5cGVJbnZhbGlkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1zLnR5cGUgPT0gJ3NlbGVjdGlvbl9jaGFuZ2UnKSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gcGFyYW1zIG5lZWRlZFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gSGFwdGljIGZlZWRiYWNrIHR5cGUgaXMgaW52YWxpZCcsIHBhcmFtcy50eXBlKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwSGFwdGljRmVlZGJhY2tUeXBlSW52YWxpZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfdHJpZ2dlcl9oYXB0aWNfZmVlZGJhY2snLCBmYWxzZSwgcGFyYW1zKTtcbiAgICAgICAgICAgIHJldHVybiBoYXB0aWNGZWVkYmFjaztcbiAgICAgICAgfVxuICAgICAgICBoYXB0aWNGZWVkYmFjay5pbXBhY3RPY2N1cnJlZCA9IGZ1bmN0aW9uIChzdHlsZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRyaWdnZXJGZWVkYmFjayh7IHR5cGU6ICdpbXBhY3QnLCBpbXBhY3Rfc3R5bGU6IHN0eWxlIH0pO1xuICAgICAgICB9O1xuICAgICAgICBoYXB0aWNGZWVkYmFjay5ub3RpZmljYXRpb25PY2N1cnJlZCA9IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJpZ2dlckZlZWRiYWNrKHsgdHlwZTogJ25vdGlmaWNhdGlvbicsIG5vdGlmaWNhdGlvbl90eXBlOiB0eXBlIH0pO1xuICAgICAgICB9O1xuICAgICAgICBoYXB0aWNGZWVkYmFjay5zZWxlY3Rpb25DaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRyaWdnZXJGZWVkYmFjayh7IHR5cGU6ICdzZWxlY3Rpb25fY2hhbmdlJyB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGhhcHRpY0ZlZWRiYWNrO1xuICAgIH0pKCk7XG4gICAgdmFyIENsb3VkU3RvcmFnZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjbG91ZFN0b3JhZ2UgPSB7fTtcbiAgICAgICAgZnVuY3Rpb24gaW52b2tlU3RvcmFnZU1ldGhvZChtZXRob2QsIHBhcmFtcywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuOScpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gQ2xvdWRTdG9yYWdlIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcE1ldGhvZFVuc3VwcG9ydGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnZva2VDdXN0b21NZXRob2QobWV0aG9kLCBwYXJhbXMsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIHJldHVybiBjbG91ZFN0b3JhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgY2xvdWRTdG9yYWdlLnNldEl0ZW0gPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBpbnZva2VTdG9yYWdlTWV0aG9kKCdzYXZlU3RvcmFnZVZhbHVlJywgeyBrZXk6IGtleSwgdmFsdWU6IHZhbHVlIH0sIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgY2xvdWRTdG9yYWdlLmdldEl0ZW0gPSBmdW5jdGlvbiAoa2V5LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgcmV0dXJuIGNsb3VkU3RvcmFnZS5nZXRJdGVtcyhba2V5XSwgY2FsbGJhY2sgPyBmdW5jdGlvbiAoZXJyLCByZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzW2tleV0pO1xuICAgICAgICAgICAgfSA6IG51bGwpO1xuICAgICAgICB9O1xuICAgICAgICBjbG91ZFN0b3JhZ2UuZ2V0SXRlbXMgPSBmdW5jdGlvbiAoa2V5cywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBpbnZva2VTdG9yYWdlTWV0aG9kKCdnZXRTdG9yYWdlVmFsdWVzJywgeyBrZXlzOiBrZXlzIH0sIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgY2xvdWRTdG9yYWdlLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAoa2V5LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgcmV0dXJuIGNsb3VkU3RvcmFnZS5yZW1vdmVJdGVtcyhba2V5XSwgY2FsbGJhY2spO1xuICAgICAgICB9O1xuICAgICAgICBjbG91ZFN0b3JhZ2UucmVtb3ZlSXRlbXMgPSBmdW5jdGlvbiAoa2V5cywgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBpbnZva2VTdG9yYWdlTWV0aG9kKCdkZWxldGVTdG9yYWdlVmFsdWVzJywgeyBrZXlzOiBrZXlzIH0sIGNhbGxiYWNrKTtcbiAgICAgICAgfTtcbiAgICAgICAgY2xvdWRTdG9yYWdlLmdldEtleXMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBpbnZva2VTdG9yYWdlTWV0aG9kKCdnZXRTdG9yYWdlS2V5cycsIHt9LCBjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjbG91ZFN0b3JhZ2U7XG4gICAgfSkoKTtcbiAgICB2YXIgd2ViQXBwSW52b2ljZXMgPSB7fTtcbiAgICBmdW5jdGlvbiBvbkludm9pY2VDbG9zZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgaWYgKGV2ZW50RGF0YS5zbHVnICYmIHdlYkFwcEludm9pY2VzW2V2ZW50RGF0YS5zbHVnXSkge1xuICAgICAgICAgICAgdmFyIGludm9pY2VEYXRhID0gd2ViQXBwSW52b2ljZXNbZXZlbnREYXRhLnNsdWddO1xuICAgICAgICAgICAgZGVsZXRlIHdlYkFwcEludm9pY2VzW2V2ZW50RGF0YS5zbHVnXTtcbiAgICAgICAgICAgIGlmIChpbnZvaWNlRGF0YS5jYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGludm9pY2VEYXRhLmNhbGxiYWNrKGV2ZW50RGF0YS5zdGF0dXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjZWl2ZVdlYlZpZXdFdmVudCgnaW52b2ljZUNsb3NlZCcsIHtcbiAgICAgICAgICAgICAgICB1cmw6IGludm9pY2VEYXRhLnVybCxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGV2ZW50RGF0YS5zdGF0dXNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZhciB3ZWJBcHBQb3B1cE9wZW5lZCA9IGZhbHNlO1xuICAgIGZ1bmN0aW9uIG9uUG9wdXBDbG9zZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgaWYgKHdlYkFwcFBvcHVwT3BlbmVkKSB7XG4gICAgICAgICAgICB2YXIgcG9wdXBEYXRhID0gd2ViQXBwUG9wdXBPcGVuZWQ7XG4gICAgICAgICAgICB3ZWJBcHBQb3B1cE9wZW5lZCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGJ1dHRvbl9pZCA9IG51bGw7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50RGF0YS5idXR0b25faWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgYnV0dG9uX2lkID0gZXZlbnREYXRhLmJ1dHRvbl9pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3B1cERhdGEuY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBwb3B1cERhdGEuY2FsbGJhY2soYnV0dG9uX2lkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlY2VpdmVXZWJWaWV3RXZlbnQoJ3BvcHVwQ2xvc2VkJywge1xuICAgICAgICAgICAgICAgIGJ1dHRvbl9pZDogYnV0dG9uX2lkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2YXIgd2ViQXBwU2NhblFyUG9wdXBPcGVuZWQgPSBmYWxzZTtcbiAgICBmdW5jdGlvbiBvblFyVGV4dFJlY2VpdmVkKGV2ZW50VHlwZSwgZXZlbnREYXRhKSB7XG4gICAgICAgIGlmICh3ZWJBcHBTY2FuUXJQb3B1cE9wZW5lZCkge1xuICAgICAgICAgICAgdmFyIHBvcHVwRGF0YSA9IHdlYkFwcFNjYW5RclBvcHVwT3BlbmVkO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBldmVudERhdGEuZGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZXZlbnREYXRhLmRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9wdXBEYXRhLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBvcHVwRGF0YS5jYWxsYmFjayhkYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICB3ZWJBcHBTY2FuUXJQb3B1cE9wZW5lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBXZWJWaWV3LnBvc3RFdmVudCgnd2ViX2FwcF9jbG9zZV9zY2FuX3FyX3BvcHVwJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlY2VpdmVXZWJWaWV3RXZlbnQoJ3FyVGV4dFJlY2VpdmVkJywge1xuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uU2NhblFyUG9wdXBDbG9zZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgd2ViQXBwU2NhblFyUG9wdXBPcGVuZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb25DbGlwYm9hcmRUZXh0UmVjZWl2ZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgaWYgKGV2ZW50RGF0YS5yZXFfaWQgJiYgd2ViQXBwQ2FsbGJhY2tzW2V2ZW50RGF0YS5yZXFfaWRdKSB7XG4gICAgICAgICAgICB2YXIgcmVxdWVzdERhdGEgPSB3ZWJBcHBDYWxsYmFja3NbZXZlbnREYXRhLnJlcV9pZF07XG4gICAgICAgICAgICBkZWxldGUgd2ViQXBwQ2FsbGJhY2tzW2V2ZW50RGF0YS5yZXFfaWRdO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBldmVudERhdGEuZGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gZXZlbnREYXRhLmRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVxdWVzdERhdGEuY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YS5jYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlY2VpdmVXZWJWaWV3RXZlbnQoJ2NsaXBib2FyZFRleHRSZWNlaXZlZCcsIHtcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2YXIgV2ViQXBwV3JpdGVBY2Nlc3NSZXF1ZXN0ZWQgPSBmYWxzZTtcbiAgICBmdW5jdGlvbiBvbldyaXRlQWNjZXNzUmVxdWVzdGVkKGV2ZW50VHlwZSwgZXZlbnREYXRhKSB7XG4gICAgICAgIGlmIChXZWJBcHBXcml0ZUFjY2Vzc1JlcXVlc3RlZCkge1xuICAgICAgICAgICAgdmFyIHJlcXVlc3REYXRhID0gV2ViQXBwV3JpdGVBY2Nlc3NSZXF1ZXN0ZWQ7XG4gICAgICAgICAgICBXZWJBcHBXcml0ZUFjY2Vzc1JlcXVlc3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYgKHJlcXVlc3REYXRhLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdERhdGEuY2FsbGJhY2soZXZlbnREYXRhLnN0YXR1cyA9PSAnYWxsb3dlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVjZWl2ZVdlYlZpZXdFdmVudCgnd3JpdGVBY2Nlc3NSZXF1ZXN0ZWQnLCB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiBldmVudERhdGEuc3RhdHVzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRSZXF1ZXN0ZWRDb250YWN0KGNhbGxiYWNrLCB0aW1lb3V0KSB7XG4gICAgICAgIHZhciByZXFUbywgZmFsbGJhY2tUbywgcmVxRGVsYXkgPSAwO1xuICAgICAgICB2YXIgcmVxSW52b2tlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaW52b2tlQ3VzdG9tTWV0aG9kKCdnZXRSZXF1ZXN0ZWRDb250YWN0Jywge30sIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoZmFsbGJhY2tUbyk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXFEZWxheSArPSA1MDtcbiAgICAgICAgICAgICAgICAgICAgcmVxVG8gPSBzZXRUaW1lb3V0KHJlcUludm9rZSwgcmVxRGVsYXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgZmFsbGJhY2tJbnZva2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQocmVxVG8pO1xuICAgICAgICAgICAgY2FsbGJhY2soJycpO1xuICAgICAgICB9O1xuICAgICAgICBmYWxsYmFja1RvID0gc2V0VGltZW91dChmYWxsYmFja0ludm9rZSwgdGltZW91dCk7XG4gICAgICAgIHJlcUludm9rZSgpO1xuICAgIH1cbiAgICB2YXIgV2ViQXBwQ29udGFjdFJlcXVlc3RlZCA9IGZhbHNlO1xuICAgIGZ1bmN0aW9uIG9uUGhvbmVSZXF1ZXN0ZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgaWYgKFdlYkFwcENvbnRhY3RSZXF1ZXN0ZWQpIHtcbiAgICAgICAgICAgIHZhciByZXF1ZXN0RGF0YSA9IFdlYkFwcENvbnRhY3RSZXF1ZXN0ZWQ7XG4gICAgICAgICAgICBXZWJBcHBDb250YWN0UmVxdWVzdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgcmVxdWVzdFNlbnQgPSBldmVudERhdGEuc3RhdHVzID09ICdzZW50JztcbiAgICAgICAgICAgIHZhciB3ZWJWaWV3RXZlbnQgPSB7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiBldmVudERhdGEuc3RhdHVzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHJlcXVlc3RTZW50KSB7XG4gICAgICAgICAgICAgICAgZ2V0UmVxdWVzdGVkQ29udGFjdChmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMgJiYgcmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2ViVmlld0V2ZW50LnJlc3BvbnNlID0gcmVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgd2ViVmlld0V2ZW50LnJlc3BvbnNlVW5zYWZlID0gVXRpbHMudXJsUGFyc2VRdWVyeVN0cmluZyhyZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHdlYlZpZXdFdmVudC5yZXNwb25zZVVuc2FmZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSB3ZWJWaWV3RXZlbnQucmVzcG9uc2VVbnNhZmVba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsLnN1YnN0cigwLCAxKSA9PSAneycgJiYgdmFsLnN1YnN0cigtMSkgPT0gJ30nIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwuc3Vic3RyKDAsIDEpID09ICdbJyAmJiB2YWwuc3Vic3RyKC0xKSA9PSAnXScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdlYlZpZXdFdmVudC5yZXNwb25zZVVuc2FmZVtrZXldID0gSlNPTi5wYXJzZSh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdERhdGEuY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLmNhbGxiYWNrKHJlcXVlc3RTZW50LCB3ZWJWaWV3RXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlY2VpdmVXZWJWaWV3RXZlbnQoJ2NvbnRhY3RSZXF1ZXN0ZWQnLCB3ZWJWaWV3RXZlbnQpO1xuICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcXVlc3REYXRhLmNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLmNhbGxiYWNrKHJlcXVlc3RTZW50LCB3ZWJWaWV3RXZlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZWNlaXZlV2ViVmlld0V2ZW50KCdjb250YWN0UmVxdWVzdGVkJywgd2ViVmlld0V2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBvbkN1c3RvbU1ldGhvZEludm9rZWQoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcbiAgICAgICAgaWYgKGV2ZW50RGF0YS5yZXFfaWQgJiYgd2ViQXBwQ2FsbGJhY2tzW2V2ZW50RGF0YS5yZXFfaWRdKSB7XG4gICAgICAgICAgICB2YXIgcmVxdWVzdERhdGEgPSB3ZWJBcHBDYWxsYmFja3NbZXZlbnREYXRhLnJlcV9pZF07XG4gICAgICAgICAgICBkZWxldGUgd2ViQXBwQ2FsbGJhY2tzW2V2ZW50RGF0YS5yZXFfaWRdO1xuICAgICAgICAgICAgdmFyIHJlcyA9IG51bGwsIGVyciA9IG51bGw7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGV2ZW50RGF0YS5yZXN1bHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcmVzID0gZXZlbnREYXRhLnJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2YgZXZlbnREYXRhLmVycm9yICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGVyciA9IGV2ZW50RGF0YS5lcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0RGF0YS5jYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHJlcXVlc3REYXRhLmNhbGxiYWNrKGVyciwgcmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmdW5jdGlvbiBpbnZva2VDdXN0b21NZXRob2QobWV0aG9kLCBwYXJhbXMsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuOScpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBNZXRob2QgaW52b2tlQ3VzdG9tTWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwTWV0aG9kVW5zdXBwb3J0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVxX2lkID0gZ2VuZXJhdGVDYWxsYmFja0lkKDE2KTtcbiAgICAgICAgdmFyIHJlcV9wYXJhbXMgPSB7IHJlcV9pZDogcmVxX2lkLCBtZXRob2Q6IG1ldGhvZCwgcGFyYW1zOiBwYXJhbXMgfHwge30gfTtcbiAgICAgICAgd2ViQXBwQ2FsbGJhY2tzW3JlcV9pZF0gPSB7XG4gICAgICAgICAgICBjYWxsYmFjazogY2FsbGJhY2tcbiAgICAgICAgfTtcbiAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfaW52b2tlX2N1c3RvbV9tZXRob2QnLCBmYWxzZSwgcmVxX3BhcmFtcyk7XG4gICAgfVxuICAgIDtcbiAgICBpZiAoIXdpbmRvdy5UZWxlZ3JhbSkge1xuICAgICAgICB3aW5kb3cuVGVsZWdyYW0gPSB7fTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ2luaXREYXRhJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHdlYkFwcEluaXREYXRhOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ2luaXREYXRhVW5zYWZlJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHdlYkFwcEluaXREYXRhVW5zYWZlOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ3ZlcnNpb24nLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gd2ViQXBwVmVyc2lvbjsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWJBcHAsICdwbGF0Zm9ybScsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB3ZWJBcHBQbGF0Zm9ybTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWJBcHAsICdjb2xvclNjaGVtZScsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb2xvclNjaGVtZTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWJBcHAsICd0aGVtZVBhcmFtcycsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGVtZVBhcmFtczsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWJBcHAsICdpc0V4cGFuZGVkJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGlzRXhwYW5kZWQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViQXBwLCAndmlld3BvcnRIZWlnaHQnLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gKHZpZXdwb3J0SGVpZ2h0ID09PSBmYWxzZSA/IHdpbmRvdy5pbm5lckhlaWdodCA6IHZpZXdwb3J0SGVpZ2h0KSAtIG1haW5CdXR0b25IZWlnaHQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViQXBwLCAndmlld3BvcnRTdGFibGVIZWlnaHQnLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gKHZpZXdwb3J0U3RhYmxlSGVpZ2h0ID09PSBmYWxzZSA/IHdpbmRvdy5pbm5lckhlaWdodCA6IHZpZXdwb3J0U3RhYmxlSGVpZ2h0KSAtIG1haW5CdXR0b25IZWlnaHQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViQXBwLCAnaXNDbG9zaW5nQ29uZmlybWF0aW9uRW5hYmxlZCcsIHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7IHNldENsb3NpbmdDb25maXJtYXRpb24odmFsKTsgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBpc0Nsb3NpbmdDb25maXJtYXRpb25FbmFibGVkOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ2hlYWRlckNvbG9yJywge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHsgc2V0SGVhZGVyQ29sb3IodmFsKTsgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBnZXRIZWFkZXJDb2xvcigpOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ2JhY2tncm91bmRDb2xvcicsIHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7IHNldEJhY2tncm91bmRDb2xvcih2YWwpOyB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGdldEJhY2tncm91bmRDb2xvcigpOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ0JhY2tCdXR0b24nLCB7XG4gICAgICAgIHZhbHVlOiBCYWNrQnV0dG9uLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ01haW5CdXR0b24nLCB7XG4gICAgICAgIHZhbHVlOiBNYWluQnV0dG9uLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFdlYkFwcCwgJ1NldHRpbmdzQnV0dG9uJywge1xuICAgICAgICB2YWx1ZTogU2V0dGluZ3NCdXR0b24sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoV2ViQXBwLCAnSGFwdGljRmVlZGJhY2snLCB7XG4gICAgICAgIHZhbHVlOiBIYXB0aWNGZWVkYmFjayxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShXZWJBcHAsICdDbG91ZFN0b3JhZ2UnLCB7XG4gICAgICAgIHZhbHVlOiBDbG91ZFN0b3JhZ2UsXG4gICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBXZWJBcHAuc2V0SGVhZGVyQ29sb3IgPSBmdW5jdGlvbiAoY29sb3Jfa2V5KSB7XG4gICAgICAgIFdlYkFwcC5oZWFkZXJDb2xvciA9IGNvbG9yX2tleTtcbiAgICB9O1xuICAgIFdlYkFwcC5zZXRCYWNrZ3JvdW5kQ29sb3IgPSBmdW5jdGlvbiAoY29sb3IpIHtcbiAgICAgICAgV2ViQXBwLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICAgIH07XG4gICAgV2ViQXBwLmVuYWJsZUNsb3NpbmdDb25maXJtYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFdlYkFwcC5pc0Nsb3NpbmdDb25maXJtYXRpb25FbmFibGVkID0gdHJ1ZTtcbiAgICB9O1xuICAgIFdlYkFwcC5kaXNhYmxlQ2xvc2luZ0NvbmZpcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgV2ViQXBwLmlzQ2xvc2luZ0NvbmZpcm1hdGlvbkVuYWJsZWQgPSBmYWxzZTtcbiAgICB9O1xuICAgIFdlYkFwcC5pc1ZlcnNpb25BdExlYXN0ID0gZnVuY3Rpb24gKHZlcikge1xuICAgICAgICByZXR1cm4gdmVyc2lvbkF0TGVhc3QodmVyKTtcbiAgICB9O1xuICAgIFdlYkFwcC5vbkV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50VHlwZSwgY2FsbGJhY2spIHtcbiAgICAgICAgb25XZWJWaWV3RXZlbnQoZXZlbnRUeXBlLCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBXZWJBcHAub2ZmRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnRUeXBlLCBjYWxsYmFjaykge1xuICAgICAgICBvZmZXZWJWaWV3RXZlbnQoZXZlbnRUeXBlLCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBXZWJBcHAuc2VuZERhdGEgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBpZiAoIWRhdGEgfHwgIWRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBEYXRhIGlzIHJlcXVpcmVkJywgZGF0YSk7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwRGF0YUludmFsaWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYnl0ZUxlbmd0aChkYXRhKSA+IDQwOTYpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIERhdGEgaXMgdG9vIGxvbmcnLCBkYXRhKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBEYXRhSW52YWxpZCcpO1xuICAgICAgICB9XG4gICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX2RhdGFfc2VuZCcsIGZhbHNlLCB7IGRhdGE6IGRhdGEgfSk7XG4gICAgfTtcbiAgICBXZWJBcHAuc3dpdGNoSW5saW5lUXVlcnkgPSBmdW5jdGlvbiAocXVlcnksIGNob29zZV9jaGF0X3R5cGVzKSB7XG4gICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuNicpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBNZXRob2Qgc3dpdGNoSW5saW5lUXVlcnkgaXMgbm90IHN1cHBvcnRlZCBpbiB2ZXJzaW9uICcgKyB3ZWJBcHBWZXJzaW9uKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBNZXRob2RVbnN1cHBvcnRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghaW5pdFBhcmFtcy50Z1dlYkFwcEJvdElubGluZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gSW5saW5lIG1vZGUgaXMgZGlzYWJsZWQgZm9yIHRoaXMgYm90LiBSZWFkIG1vcmUgYWJvdXQgaW5saW5lIG1vZGU6IGh0dHBzOi8vY29yZS50ZWxlZ3JhbS5vcmcvYm90cy9pbmxpbmUnKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBJbmxpbmVNb2RlRGlzYWJsZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBxdWVyeSA9IHF1ZXJ5IHx8ICcnO1xuICAgICAgICBpZiAocXVlcnkubGVuZ3RoID4gMjU2KSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBJbmxpbmUgcXVlcnkgaXMgdG9vIGxvbmcnLCBxdWVyeSk7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwSW5saW5lUXVlcnlJbnZhbGlkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNoYXRfdHlwZXMgPSBbXTtcbiAgICAgICAgaWYgKGNob29zZV9jaGF0X3R5cGVzKSB7XG4gICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY2hvb3NlX2NoYXRfdHlwZXMpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gQ2hvb3NlIGNoYXQgdHlwZXMgc2hvdWxkIGJlIGFuIGFycmF5JywgY2hvb3NlX2NoYXRfdHlwZXMpO1xuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBJbmxpbmVDaG9vc2VDaGF0VHlwZXNJbnZhbGlkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZ29vZF90eXBlcyA9IHsgdXNlcnM6IDEsIGJvdHM6IDEsIGdyb3VwczogMSwgY2hhbm5lbHM6IDEgfTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hvb3NlX2NoYXRfdHlwZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY2hhdF90eXBlID0gY2hvb3NlX2NoYXRfdHlwZXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKCFnb29kX3R5cGVzW2NoYXRfdHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gQ2hvb3NlIGNoYXQgdHlwZSBpcyBpbnZhbGlkJywgY2hhdF90eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcElubGluZUNob29zZUNoYXRUeXBlSW52YWxpZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZ29vZF90eXBlc1tjaGF0X3R5cGVdICE9IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgZ29vZF90eXBlc1tjaGF0X3R5cGVdID0gMjtcbiAgICAgICAgICAgICAgICAgICAgY2hhdF90eXBlcy5wdXNoKGNoYXRfdHlwZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX3N3aXRjaF9pbmxpbmVfcXVlcnknLCBmYWxzZSwgeyBxdWVyeTogcXVlcnksIGNoYXRfdHlwZXM6IGNoYXRfdHlwZXMgfSk7XG4gICAgfTtcbiAgICBXZWJBcHAub3BlbkxpbmsgPSBmdW5jdGlvbiAodXJsLCBvcHRpb25zKSB7XG4gICAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnQScpO1xuICAgICAgICBhLmhyZWYgPSB1cmw7XG4gICAgICAgIGlmIChhLnByb3RvY29sICE9ICdodHRwOicgJiZcbiAgICAgICAgICAgIGEucHJvdG9jb2wgIT0gJ2h0dHBzOicpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIFVybCBwcm90b2NvbCBpcyBub3Qgc3VwcG9ydGVkJywgdXJsKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBUZ1VybEludmFsaWQnKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdXJsID0gYS5ocmVmO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAgICAgaWYgKHZlcnNpb25BdExlYXN0KCc2LjEnKSkge1xuICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfb3Blbl9saW5rJywgZmFsc2UsIHsgdXJsOiB1cmwsIHRyeV9pbnN0YW50X3ZpZXc6IHZlcnNpb25BdExlYXN0KCc2LjQnKSAmJiAhIW9wdGlvbnMudHJ5X2luc3RhbnRfdmlldyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19ibGFuaycpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBXZWJBcHAub3BlblRlbGVncmFtTGluayA9IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdBJyk7XG4gICAgICAgIGEuaHJlZiA9IHVybDtcbiAgICAgICAgaWYgKGEucHJvdG9jb2wgIT0gJ2h0dHA6JyAmJlxuICAgICAgICAgICAgYS5wcm90b2NvbCAhPSAnaHR0cHM6Jykge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gVXJsIHByb3RvY29sIGlzIG5vdCBzdXBwb3J0ZWQnLCB1cmwpO1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcFRnVXJsSW52YWxpZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhLmhvc3RuYW1lICE9ICd0Lm1lJykge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gVXJsIGhvc3QgaXMgbm90IHN1cHBvcnRlZCcsIHVybCk7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwVGdVcmxJbnZhbGlkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBhdGhfZnVsbCA9IGEucGF0aG5hbWUgKyBhLnNlYXJjaDtcbiAgICAgICAgaWYgKGlzSWZyYW1lIHx8IHZlcnNpb25BdExlYXN0KCc2LjEnKSkge1xuICAgICAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfb3Blbl90Z19saW5rJywgZmFsc2UsIHsgcGF0aF9mdWxsOiBwYXRoX2Z1bGwgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gJ2h0dHBzOi8vdC5tZScgKyBwYXRoX2Z1bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFdlYkFwcC5vcGVuSW52b2ljZSA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnQScpLCBtYXRjaCwgc2x1ZztcbiAgICAgICAgYS5ocmVmID0gdXJsO1xuICAgICAgICBpZiAoYS5wcm90b2NvbCAhPSAnaHR0cDonICYmXG4gICAgICAgICAgICBhLnByb3RvY29sICE9ICdodHRwczonIHx8XG4gICAgICAgICAgICBhLmhvc3RuYW1lICE9ICd0Lm1lJyB8fFxuICAgICAgICAgICAgIShtYXRjaCA9IGEucGF0aG5hbWUubWF0Y2goL15cXC8oXFwkfGludm9pY2VcXC8pKFtBLVphLXowLTlcXC1fPV0rKSQvKSkgfHxcbiAgICAgICAgICAgICEoc2x1ZyA9IG1hdGNoWzJdKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gSW52b2ljZSB1cmwgaXMgaW52YWxpZCcsIHVybCk7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwSW52b2ljZVVybEludmFsaWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXZlcnNpb25BdExlYXN0KCc2LjEnKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gTWV0aG9kIG9wZW5JbnZvaWNlIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwTWV0aG9kVW5zdXBwb3J0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2ViQXBwSW52b2ljZXNbc2x1Z10pIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIEludm9pY2UgaXMgYWxyZWFkeSBvcGVuZWQnKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBJbnZvaWNlT3BlbmVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgd2ViQXBwSW52b2ljZXNbc2x1Z10gPSB7XG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xuICAgICAgICB9O1xuICAgICAgICBXZWJWaWV3LnBvc3RFdmVudCgnd2ViX2FwcF9vcGVuX2ludm9pY2UnLCBmYWxzZSwgeyBzbHVnOiBzbHVnIH0pO1xuICAgIH07XG4gICAgV2ViQXBwLnNob3dQb3B1cCA9IGZ1bmN0aW9uIChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuMicpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBNZXRob2Qgc2hvd1BvcHVwIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdmVyc2lvbiAnICsgd2ViQXBwVmVyc2lvbik7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwTWV0aG9kVW5zdXBwb3J0ZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2ViQXBwUG9wdXBPcGVuZWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIFBvcHVwIGlzIGFscmVhZHkgb3BlbmVkJyk7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwUG9wdXBPcGVuZWQnKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGl0bGUgPSAnJztcbiAgICAgICAgdmFyIG1lc3NhZ2UgPSAnJztcbiAgICAgICAgdmFyIGJ1dHRvbnMgPSBbXTtcbiAgICAgICAgdmFyIHBvcHVwX2J1dHRvbnMgPSB7fTtcbiAgICAgICAgdmFyIHBvcHVwX3BhcmFtcyA9IHt9O1xuICAgICAgICBpZiAodHlwZW9mIHBhcmFtcy50aXRsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRpdGxlID0gc3RyVHJpbShwYXJhbXMudGl0bGUpO1xuICAgICAgICAgICAgaWYgKHRpdGxlLmxlbmd0aCA+IDY0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgdGl0bGUgaXMgdG9vIGxvbmcnLCB0aXRsZSk7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcFBvcHVwUGFyYW1JbnZhbGlkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGl0bGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHBvcHVwX3BhcmFtcy50aXRsZSA9IHRpdGxlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcGFyYW1zLm1lc3NhZ2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBtZXNzYWdlID0gc3RyVHJpbShwYXJhbXMubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFtZXNzYWdlLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgbWVzc2FnZSBpcyByZXF1aXJlZCcsIHBhcmFtcy5tZXNzYWdlKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBQb3B1cFBhcmFtSW52YWxpZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtZXNzYWdlLmxlbmd0aCA+IDI1Nikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgbWVzc2FnZSBpcyB0b28gbG9uZycsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcFBvcHVwUGFyYW1JbnZhbGlkJyk7XG4gICAgICAgIH1cbiAgICAgICAgcG9wdXBfcGFyYW1zLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICBpZiAodHlwZW9mIHBhcmFtcy5idXR0b25zICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHBhcmFtcy5idXR0b25zKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIFBvcHVwIGJ1dHRvbnMgc2hvdWxkIGJlIGFuIGFycmF5JywgcGFyYW1zLmJ1dHRvbnMpO1xuICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBQb3B1cFBhcmFtSW52YWxpZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJhbXMuYnV0dG9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSBwYXJhbXMuYnV0dG9uc1tpXTtcbiAgICAgICAgICAgICAgICB2YXIgYnRuID0ge307XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBidXR0b24uaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlkID0gYnV0dG9uLmlkLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpZC5sZW5ndGggPiA2NCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgYnV0dG9uIGlkIGlzIHRvbyBsb25nJywgaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcFBvcHVwUGFyYW1JbnZhbGlkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnRuLmlkID0gaWQ7XG4gICAgICAgICAgICAgICAgdmFyIGJ1dHRvbl90eXBlID0gYnV0dG9uLnR5cGU7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBidXR0b25fdHlwZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uX3R5cGUgPSAnZGVmYXVsdCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJ0bi50eXBlID0gYnV0dG9uX3R5cGU7XG4gICAgICAgICAgICAgICAgaWYgKGJ1dHRvbl90eXBlID09ICdvaycgfHxcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uX3R5cGUgPT0gJ2Nsb3NlJyB8fFxuICAgICAgICAgICAgICAgICAgICBidXR0b25fdHlwZSA9PSAnY2FuY2VsJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBubyBwYXJhbXMgbmVlZGVkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJ1dHRvbl90eXBlID09ICdkZWZhdWx0JyB8fFxuICAgICAgICAgICAgICAgICAgICBidXR0b25fdHlwZSA9PSAnZGVzdHJ1Y3RpdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYnV0dG9uLnRleHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gc3RyVHJpbShidXR0b24udGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgYnV0dG9uIHRleHQgaXMgcmVxdWlyZWQgZm9yIHR5cGUgJyArIGJ1dHRvbl90eXBlLCBidXR0b24udGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwUG9wdXBQYXJhbUludmFsaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGV4dC5sZW5ndGggPiA2NCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgYnV0dG9uIHRleHQgaXMgdG9vIGxvbmcnLCB0ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBQb3B1cFBhcmFtSW52YWxpZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJ0bi50ZXh0ID0gdGV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIFBvcHVwIGJ1dHRvbiB0eXBlIGlzIGludmFsaWQnLCBidXR0b25fdHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBQb3B1cFBhcmFtSW52YWxpZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBidXR0b25zLnB1c2goYnRuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJ1dHRvbnMucHVzaCh7IGlkOiAnJywgdHlwZTogJ2Nsb3NlJyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYnV0dG9ucy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBQb3B1cCBzaG91bGQgaGF2ZSBhdCBsZWFzdCBvbmUgYnV0dG9uJyk7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcignV2ViQXBwUG9wdXBQYXJhbUludmFsaWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYnV0dG9ucy5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBQb3B1cCBzaG91bGQgbm90IGhhdmUgbW9yZSB0aGFuIDMgYnV0dG9ucycpO1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcFBvcHVwUGFyYW1JbnZhbGlkJyk7XG4gICAgICAgIH1cbiAgICAgICAgcG9wdXBfcGFyYW1zLmJ1dHRvbnMgPSBidXR0b25zO1xuICAgICAgICB3ZWJBcHBQb3B1cE9wZW5lZCA9IHtcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xuICAgICAgICB9O1xuICAgICAgICBXZWJWaWV3LnBvc3RFdmVudCgnd2ViX2FwcF9vcGVuX3BvcHVwJywgZmFsc2UsIHBvcHVwX3BhcmFtcyk7XG4gICAgfTtcbiAgICBXZWJBcHAuc2hvd0FsZXJ0ID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGNhbGxiYWNrKSB7XG4gICAgICAgIFdlYkFwcC5zaG93UG9wdXAoe1xuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxuICAgICAgICB9LCBjYWxsYmFjayA/IGZ1bmN0aW9uICgpIHsgY2FsbGJhY2soKTsgfSA6IG51bGwpO1xuICAgIH07XG4gICAgV2ViQXBwLnNob3dDb25maXJtID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGNhbGxiYWNrKSB7XG4gICAgICAgIFdlYkFwcC5zaG93UG9wdXAoe1xuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAgICB7IHR5cGU6ICdvaycsIGlkOiAnb2snIH0sXG4gICAgICAgICAgICAgICAgeyB0eXBlOiAnY2FuY2VsJyB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0sIGNhbGxiYWNrID8gZnVuY3Rpb24gKGJ1dHRvbl9pZCkge1xuICAgICAgICAgICAgY2FsbGJhY2soYnV0dG9uX2lkID09ICdvaycpO1xuICAgICAgICB9IDogbnVsbCk7XG4gICAgfTtcbiAgICBXZWJBcHAuc2hvd1NjYW5RclBvcHVwID0gZnVuY3Rpb24gKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCF2ZXJzaW9uQXRMZWFzdCgnNi40JykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIE1ldGhvZCBzaG93U2NhblFyUG9wdXAgaXMgbm90IHN1cHBvcnRlZCBpbiB2ZXJzaW9uICcgKyB3ZWJBcHBWZXJzaW9uKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBNZXRob2RVbnN1cHBvcnRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3ZWJBcHBTY2FuUXJQb3B1cE9wZW5lZCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gUG9wdXAgaXMgYWxyZWFkeSBvcGVuZWQnKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBTY2FuUXJQb3B1cE9wZW5lZCcpO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0ZXh0ID0gJyc7XG4gICAgICAgIHZhciBwb3B1cF9wYXJhbXMgPSB7fTtcbiAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMudGV4dCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRleHQgPSBzdHJUcmltKHBhcmFtcy50ZXh0KTtcbiAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDY0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gU2NhbiBRUiBwb3B1cCB0ZXh0IGlzIHRvbyBsb25nJywgdGV4dCk7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcFNjYW5RclBvcHVwUGFyYW1JbnZhbGlkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGV4dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcG9wdXBfcGFyYW1zLnRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdlYkFwcFNjYW5RclBvcHVwT3BlbmVkID0ge1xuICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXG4gICAgICAgIH07XG4gICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX29wZW5fc2Nhbl9xcl9wb3B1cCcsIGZhbHNlLCBwb3B1cF9wYXJhbXMpO1xuICAgIH07XG4gICAgV2ViQXBwLmNsb3NlU2NhblFyUG9wdXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdmVyc2lvbkF0TGVhc3QoJzYuNCcpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBNZXRob2QgY2xvc2VTY2FuUXJQb3B1cCBpcyBub3Qgc3VwcG9ydGVkIGluIHZlcnNpb24gJyArIHdlYkFwcFZlcnNpb24pO1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcE1ldGhvZFVuc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgd2ViQXBwU2NhblFyUG9wdXBPcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfY2xvc2Vfc2Nhbl9xcl9wb3B1cCcsIGZhbHNlKTtcbiAgICB9O1xuICAgIFdlYkFwcC5yZWFkVGV4dEZyb21DbGlwYm9hcmQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCF2ZXJzaW9uQXRMZWFzdCgnNi40JykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIE1ldGhvZCByZWFkVGV4dEZyb21DbGlwYm9hcmQgaXMgbm90IHN1cHBvcnRlZCBpbiB2ZXJzaW9uICcgKyB3ZWJBcHBWZXJzaW9uKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBNZXRob2RVbnN1cHBvcnRlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXFfaWQgPSBnZW5lcmF0ZUNhbGxiYWNrSWQoMTYpO1xuICAgICAgICB2YXIgcmVxX3BhcmFtcyA9IHsgcmVxX2lkOiByZXFfaWQgfTtcbiAgICAgICAgd2ViQXBwQ2FsbGJhY2tzW3JlcV9pZF0gPSB7XG4gICAgICAgICAgICBjYWxsYmFjazogY2FsbGJhY2tcbiAgICAgICAgfTtcbiAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfcmVhZF90ZXh0X2Zyb21fY2xpcGJvYXJkJywgZmFsc2UsIHJlcV9wYXJhbXMpO1xuICAgIH07XG4gICAgV2ViQXBwLnJlcXVlc3RXcml0ZUFjY2VzcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICBpZiAoIXZlcnNpb25BdExlYXN0KCc2LjknKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignW1RlbGVncmFtLldlYkFwcF0gTWV0aG9kIHJlcXVlc3RXcml0ZUFjY2VzcyBpcyBub3Qgc3VwcG9ydGVkIGluIHZlcnNpb24gJyArIHdlYkFwcFZlcnNpb24pO1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcE1ldGhvZFVuc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFdlYkFwcFdyaXRlQWNjZXNzUmVxdWVzdGVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdbVGVsZWdyYW0uV2ViQXBwXSBXcml0ZSBhY2Nlc3MgaXMgYWxyZWFkeSByZXF1ZXN0ZWQnKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBXcml0ZUFjY2Vzc1JlcXVlc3RlZCcpO1xuICAgICAgICB9XG4gICAgICAgIFdlYkFwcFdyaXRlQWNjZXNzUmVxdWVzdGVkID0ge1xuICAgICAgICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrXG4gICAgICAgIH07XG4gICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX3JlcXVlc3Rfd3JpdGVfYWNjZXNzJyk7XG4gICAgfTtcbiAgICBXZWJBcHAucmVxdWVzdENvbnRhY3QgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCF2ZXJzaW9uQXRMZWFzdCgnNi45JykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIE1ldGhvZCByZXF1ZXN0Q29udGFjdCBpcyBub3Qgc3VwcG9ydGVkIGluIHZlcnNpb24gJyArIHdlYkFwcFZlcnNpb24pO1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1dlYkFwcE1ldGhvZFVuc3VwcG9ydGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFdlYkFwcENvbnRhY3RSZXF1ZXN0ZWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tUZWxlZ3JhbS5XZWJBcHBdIENvbnRhY3QgaXMgYWxyZWFkeSByZXF1ZXN0ZWQnKTtcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdXZWJBcHBDb250YWN0UmVxdWVzdGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgV2ViQXBwQ29udGFjdFJlcXVlc3RlZCA9IHtcbiAgICAgICAgICAgIGNhbGxiYWNrOiBjYWxsYmFja1xuICAgICAgICB9O1xuICAgICAgICBXZWJWaWV3LnBvc3RFdmVudCgnd2ViX2FwcF9yZXF1ZXN0X3Bob25lJyk7XG4gICAgfTtcbiAgICBXZWJBcHAuaW52b2tlQ3VzdG9tTWV0aG9kID0gZnVuY3Rpb24gKG1ldGhvZCwgcGFyYW1zLCBjYWxsYmFjaykge1xuICAgICAgICBpbnZva2VDdXN0b21NZXRob2QobWV0aG9kLCBwYXJhbXMsIGNhbGxiYWNrKTtcbiAgICB9O1xuICAgIFdlYkFwcC5yZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgV2ViVmlldy5wb3N0RXZlbnQoJ3dlYl9hcHBfcmVhZHknKTtcbiAgICB9O1xuICAgIFdlYkFwcC5leHBhbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX2V4cGFuZCcpO1xuICAgIH07XG4gICAgV2ViQXBwLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBXZWJWaWV3LnBvc3RFdmVudCgnd2ViX2FwcF9jbG9zZScpO1xuICAgIH07XG4gICAgd2luZG93LlRlbGVncmFtLldlYkFwcCA9IFdlYkFwcDtcbiAgICB1cGRhdGVIZWFkZXJDb2xvcigpO1xuICAgIHVwZGF0ZUJhY2tncm91bmRDb2xvcigpO1xuICAgIHNldFZpZXdwb3J0SGVpZ2h0KCk7XG4gICAgaWYgKGluaXRQYXJhbXMudGdXZWJBcHBTaG93U2V0dGluZ3MpIHtcbiAgICAgICAgU2V0dGluZ3NCdXR0b24uc2hvdygpO1xuICAgIH1cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUpO1xuICAgIGlmIChpc0lmcmFtZSkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGxpbmtIYW5kbGVyKTtcbiAgICB9XG4gICAgV2ViVmlldy5vbkV2ZW50KCd0aGVtZV9jaGFuZ2VkJywgb25UaGVtZUNoYW5nZWQpO1xuICAgIFdlYlZpZXcub25FdmVudCgndmlld3BvcnRfY2hhbmdlZCcsIG9uVmlld3BvcnRDaGFuZ2VkKTtcbiAgICBXZWJWaWV3Lm9uRXZlbnQoJ2ludm9pY2VfY2xvc2VkJywgb25JbnZvaWNlQ2xvc2VkKTtcbiAgICBXZWJWaWV3Lm9uRXZlbnQoJ3BvcHVwX2Nsb3NlZCcsIG9uUG9wdXBDbG9zZWQpO1xuICAgIFdlYlZpZXcub25FdmVudCgncXJfdGV4dF9yZWNlaXZlZCcsIG9uUXJUZXh0UmVjZWl2ZWQpO1xuICAgIFdlYlZpZXcub25FdmVudCgnc2Nhbl9xcl9wb3B1cF9jbG9zZWQnLCBvblNjYW5RclBvcHVwQ2xvc2VkKTtcbiAgICBXZWJWaWV3Lm9uRXZlbnQoJ2NsaXBib2FyZF90ZXh0X3JlY2VpdmVkJywgb25DbGlwYm9hcmRUZXh0UmVjZWl2ZWQpO1xuICAgIFdlYlZpZXcub25FdmVudCgnd3JpdGVfYWNjZXNzX3JlcXVlc3RlZCcsIG9uV3JpdGVBY2Nlc3NSZXF1ZXN0ZWQpO1xuICAgIFdlYlZpZXcub25FdmVudCgncGhvbmVfcmVxdWVzdGVkJywgb25QaG9uZVJlcXVlc3RlZCk7XG4gICAgV2ViVmlldy5vbkV2ZW50KCdjdXN0b21fbWV0aG9kX2ludm9rZWQnLCBvbkN1c3RvbU1ldGhvZEludm9rZWQpO1xuICAgIFdlYlZpZXcucG9zdEV2ZW50KCd3ZWJfYXBwX3JlcXVlc3RfdGhlbWUnKTtcbiAgICBXZWJWaWV3LnBvc3RFdmVudCgnd2ViX2FwcF9yZXF1ZXN0X3ZpZXdwb3J0Jyk7XG59KSgpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGVsZWdyYW0td2ViLWFwcHMuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/./node_modules/@twa-dev/sdk/dist/telegram-web-apps.js\n"));

/***/ })

}]);